package archenoah.web.normal.main.Menuepunkte.Individuelle.Stammdaten.Patientenverwaltung.Form;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;

import org.apache.commons.lang3.tuple.Pair;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container;
import com.vaadin.server.ExternalResource;
import com.vaadin.server.ThemeResource;
import com.vaadin.ui.AbstractField;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.MenuBar.MenuItem;
import com.vaadin.ui.NativeSelect;
import com.vaadin.ui.Panel;
import com.vaadin.ui.PopupDateField;
import com.vaadin.ui.RichTextArea;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

import archenoah.config.CMS_Config_Std;
import archenoah.lib.custom.DataSetComparator;
import archenoah.lib.custom.MyUtils;
import archenoah.lib.tool.comunication.dbclass.DBClass;
import archenoah.lib.tool.comunication.email.Mailer;
import archenoah.lib.tool.comunication.email.Mailer.MAIL_TYPE;
import archenoah.lib.tool.comunication.email.MailerGroup;
import archenoah.lib.tool.templating.TemplatingRenderer;
import archenoah.lib.vaadin.Components.Combo.nativecombo;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Tab_Menue_Item;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Window_Button;
import archenoah.lib.vaadin.Forms_Builder.Form_Bind;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalNotifiers;
import archenoah.lib.vaadin.Language.i18n.I18nManager;
import archenoah.lib.vaadin.MenuBerechtigung.Rechteholen;
import archenoah.lib.vaadin.resources.Icons;
import archenoah.lib.vaadin.valchecker.val_checker4;
import archenoah.web.normal.UserInfo.UserData;
import archenoah.web.normal.main.Menuepunkte.Individuelle.Stammdaten.Patientenverwaltung.Form.Validatoren.CustomEmailValidator;
import archenoah.web.normal.main.Menuepunkte.Individuelle.Stammdaten.Patientenverwaltung.Form.Validatoren.Custom_Validator_plz;
import archenoah.web.normal.main.Menuepunkte.Individuelle.Stammdaten.Patientenverwaltung.Form.Validatoren.Custom_Validator_tel;
import archenoah.web.normal.main.Menuepunkte.Individuelle.Stammdaten.Patientenverwaltung.classes.PatientMonitoringFirmsComponent;

public class form_patient_insert_edit extends CustomComponent {

    /*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

    @AutoGenerated
	private VerticalLayout mainLayout;

	@AutoGenerated
	private HorizontalLayout horizontalLayout_3;

	@AutoGenerated
	private Button btn_save;

	@AutoGenerated
	private Button btn_zuw_arzt;

	@AutoGenerated
	private HorizontalLayout horizontalLayout_1;

	@AutoGenerated
	private VerticalLayout verticalLayout_5;

	@AutoGenerated
	private TabSheet tabs;

	@AutoGenerated
	private PatientMonitoringFirmsComponent monitoringFirms;

	@AutoGenerated
	private HorizontalLayout layoutPrescriptions2;

	@AutoGenerated
	private VerticalLayout verticalLayout_10;

	@AutoGenerated
	private PopupDateField prescriptionsPermanentGrantUntil;

	@AutoGenerated
	private PopupDateField prescriptionsNoFeesUntil;

	@AutoGenerated
	private RichTextArea rta_bemerkungen;

	@AutoGenerated
	private HorizontalLayout horizontalLayout_2;

	@AutoGenerated
	private VerticalLayout verticalLayout_7;

	@AutoGenerated
	private Panel pan_anschrift;

	@AutoGenerated
	private VerticalLayout verticalLayout_9;

	@AutoGenerated
	private Button btn_maps;

	@AutoGenerated
	private NativeSelect ns_countrycode;

	@AutoGenerated
	private TextField txt_ort;

	@AutoGenerated
	private TextField txt_plz;

	@AutoGenerated
	private TextField txt_zusatz;

	@AutoGenerated
	private TextField txt_strasse;

	@AutoGenerated
	private VerticalLayout verticalLayout_6;

	@AutoGenerated
	private Panel pan_erreichbarkeit;

	@AutoGenerated
	private VerticalLayout verticalLayout_8;

	@AutoGenerated
	private Button btn_email_send;

	@AutoGenerated
	private TextField txt_email;

	@AutoGenerated
	private TextField txt_handy;

	@AutoGenerated
	private TextField txt_tel;

	@AutoGenerated
	private VerticalLayout verticalLayout_2;

	@AutoGenerated
	private Panel pan_grundaten;

	@AutoGenerated
	private VerticalLayout verticalLayout_4;

	@AutoGenerated
	private PopupDateField pop_geb;

	@AutoGenerated
	private TextField txt_vorname;

	@AutoGenerated
	private TextField txt_name;

	@AutoGenerated
	private NativeSelect ns_anrede;

	@AutoGenerated
	private TextField txt_titel;

	@AutoGenerated
	private Panel pan_ind_id;

	@AutoGenerated
	private VerticalLayout verticalLayout_3;

	@AutoGenerated
	private NativeSelect ns_krankenkasse;

	

    

    

    

    

    

    

    

    

    

    

    

    /**
     * The constructor should first build the main layout, set the composition root and then do any custom initialization.
     * 
     * The constructor will not be automatically regenerated by the visual editor.
     */

    /**************** --> Allgemein <--- ********************/
    // Allgemein
    private CMS_Config_Std std;
    private String Exportname;
    // Datenbank
    private Map<Object, String> DBMap;
    private Map<Object, String> ValidateMap;
    private ArrayList<AbstractField> mailCheckFields;
    private DBClass db;
    private Form_Bind fb;
    private String Form_ID = "";
    // Berrechtigung
    private int ACC_ID;
    private int Lesen;
    private int Schreiben;
    private int Erstellen;
    private int Edit;
    private int Löschen;

    private MenuItem Temp_Menü = null;

    private Button Temp_Btn = null;
    /******************************************************/
    /**************** --> Tabsheetvars <--- *****************/
    private TabSheet tab = null;

    /******************************************************/
    /**************** --> Windowvars <--- *******************/
    private Window win = null;
    /******************************************************/
    /******************* --> Custom <--- ********************/
    private final String Loaded_Lagacy_ID = "";
    private DataSetComparator dataSetComparator;
    /******************************************************/

    /************ ----->Einstellungen<-- ********************/
//    private final String LNG_FRM_ID = "15";
    private final String BER_MEN_ID = "";
    private final String Windows_Height = "700px";
    private final String Windows_Width = "800px";

    private I18nManager i18n;

    /***************************** ---> Feste Funtionen<--- **************************************/

    /******************************************************/

    public form_patient_insert_edit(MenuItem Arg_Menü, String Arg_Form_ID) {
        Temp_Menü = Arg_Menü;
        Form_ID = Arg_Form_ID;

        // TODO add user code here
    }

    public form_patient_insert_edit(Button Arg_btn, String Arg_Form_ID) {

        Temp_Btn = Arg_btn;
        Form_ID = Arg_Form_ID;

        // TODO add user code here
    }

    /***************************** ---> Feste Funtionen<--- **************************************/

    /********* INIT-Window ************/
    public Window Init_Class_Window() {
        if (Windows_Height.equals("") == true || Windows_Width.equals("") == true) {
            System.out.println("Form Einstellung Fehlt: !!!");
            return null;
        }

        Standard_Init();

        if (Temp_Menü != null) {
            String Recourcename = Temp_Menü.getIcon().toString();
            Recourcename = Recourcename.substring(0, Recourcename.length() - 12) + "white-16.png";

            Exportname = Temp_Menü.getText();
            Build_Window_Button bwb = new Build_Window_Button(Temp_Menü.getText(), mainLayout, Windows_Height, Windows_Width, new ThemeResource(Recourcename));
            win = bwb.ReturnWindow();
        }
        if (Temp_Btn != null) {
            Exportname = Temp_Btn.getCaption();
            Build_Window_Button bwb = new Build_Window_Button(Temp_Btn.getCaption(), mainLayout, Windows_Height, Windows_Width, Temp_Btn.getIcon());
            win = bwb.ReturnWindow();
        }
        
        return win;
        
    }

    /********* INIT-Tray ************/
    public void Init_Class_Tab(TabSheet Arg_tab) {

        Standard_Init();
        tab = Arg_tab;
        if (Temp_Menü != null) {
            Exportname = Temp_Menü.getText();
            Build_Tab_Menue_Item bt = new Build_Tab_Menue_Item(Arg_tab, Temp_Menü.getText(), mainLayout, Temp_Menü.getIcon());
        }
        if (Temp_Btn != null) {
            Exportname = Temp_Btn.getCaption();
            Build_Tab_Menue_Item bt = new Build_Tab_Menue_Item(Arg_tab, Temp_Btn.getCaption(), mainLayout, Temp_Btn.getIcon());
        }

    }
    
    public Window getWindow() {
        return win;
    }
    
    /********* Init-Standard ************/
    private void Standard_Init() {
        buildMainLayout();
        i18n = new I18nManager(this);

        pop_geb.setDateFormat(((SimpleDateFormat)
            DateFormat.getDateInstance(DateFormat.MEDIUM, UI.getCurrent().getLocale())).toPattern());

        Set_DB_Map();

        Set_Validierer();
        Set_Validate_Map();
        generateMailCheckList();

        /********** Custom Fill Function *******************/

        Anrede_holen();
        Krankenkasse_holen();
        fillCountrycode();

        /***************************************************/

        if (Form_ID != "") {

            Forms_Fill();
            monitoringFirms.setParentId(Integer.parseInt(Form_ID));

        } else {
            btn_zuw_arzt.setEnabled(false);
        }

        event();
        
        ns_countrycode.setRequired(true);
        
        // migrated from database
        btn_zuw_arzt.setIcon(Icons.White.arzt_16);
        btn_maps.setIcon(Icons.Other.maps);
        btn_save.setIcon(Icons.White.save_16);
        btn_email_send.setIcon(Icons.White.mail_16);
        txt_vorname.setRequired(true);
        ns_anrede.setRequired(true);
        txt_strasse.setRequired(true);
        txt_ort.setRequired(true);
        txt_plz.setRequired(true);
        txt_name.setRequired(true);
        // migration end
        
        // win.addAction(new ClickShortcut(btn_save, KeyCode.ENTER));
        i18n.refresh();

    }

    /*********************************/

    /*************************** Events *******************************/

    private void event() {

        btn_save.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {
                // TODO Automatisch generierter Methodenstub

                if (Validate_Test() == false) {
                    I18nManager.global(I18nGlobalNotifiers.fields_empty);
                    return;
                }

                if (Form_ID.equals("") == true) {
                    Integer fid = Forms_Insert();
                    Form_ID = Integer.toString(fid);
                    
                    monitoringFirms.save(fid);

                } else {
                    monitoringFirms.save();
                    checkMailNotifications();
                    Forms_Update();
                }

                UI.getCurrent().getUI().removeWindow(win);
            }

        });

        btn_zuw_arzt.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {
                // TODO Automatisch generierter Methodenstub

                data_view_behandelnderarzt vb = new data_view_behandelnderarzt(event.getButton());
                vb.Set_Patienten_ID(Form_ID);

                if (Schreiben == 0) {
                    vb.Set_Berrechtigung_Custom(1, 0, 0, 0);
                } else if (Löschen == 0) {
                    vb.Set_Berrechtigung_Custom(1, 1, 1, 0);
                } else {
                    vb.Set_Berrechtigung_Custom(1, 1, 1, 1);
                }

                vb.Init_Class_Window();
                vb.Set_Form_for_Ber();
            }
        });

        btn_email_send.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {
                // TODO Automatisch generierter Methodenstub
                Neue_Email();
            }
        });

        btn_maps.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {
                // TODO Automatisch generierter Methodenstub
                Adresse_in_Goolemaps_Anzeigen();
            }
        });

    }

    /******************************************************************/

    /************************ --> Berrechtigung <-- **************************/

    public void Set_Berrechtigung_Database() {
        if (BER_MEN_ID == "") {
            System.out.println("Form Einstellung Fehlt: !!!");
            return;
        }

        ACC_ID = (int) UI.getCurrent().getSession().getSession().getAttribute("Userid");
        Rechteholen r = new Rechteholen(ACC_ID + "");
        String[][] Asan = r.Datenholen();

        for (int i = 0; i < Asan.length; i++) {
            if (Asan[i][0].equals(BER_MEN_ID) == true) {

                Lesen = Integer.valueOf(Asan[i][3]);

                Schreiben = Integer.valueOf(Asan[i][4]);
                Erstellen = Integer.valueOf(Asan[i][6]);
                Löschen = Integer.valueOf(Asan[i][5]);
            }
        }
    }

    public void Set_Berrechtigung_Custom(int Arg_Lesen, int Arg_Erstellen, int Arg_Bearbeiten, int Arg_Loeschen) {
        Lesen = Arg_Lesen;
        Schreiben = Arg_Erstellen;
        Erstellen = Arg_Erstellen;
        Edit = Arg_Bearbeiten;
        Löschen = Arg_Loeschen;

        if (Edit == 0 && Erstellen == 0) {
            btn_save.setEnabled(false);
        }

    }

    /**********************************************************************/

    /************************** Einstellen **************************************/

    /******************** Database *****************/
    private void Set_DB_Map() {
        DBMap = new HashMap<>();
        DBMap.put(ns_krankenkasse, "cust_patient_stammdaten_liste:PSL_KOSTENTRAEGER_ID");
        DBMap.put(txt_titel, "cust_patient_stammdaten_liste:PSL_TITEL");
        DBMap.put(ns_anrede, "cust_patient_stammdaten_liste:PSL_ANREDE");
        DBMap.put(txt_name, "cust_patient_stammdaten_liste:PSL_NAME");
        DBMap.put(txt_vorname, "cust_patient_stammdaten_liste:PSL_VORNAME");
        DBMap.put(pop_geb, "cust_patient_stammdaten_liste:PSL_GEB_DATUM");
        DBMap.put(txt_tel, "cust_patient_stammdaten_liste:PSL_TEL");
        DBMap.put(txt_handy, "cust_patient_stammdaten_liste:PSL_HANDY");
        DBMap.put(txt_email, "cust_patient_stammdaten_liste:PSL_EMAIL");
        DBMap.put(txt_strasse, "cust_patient_stammdaten_liste:PSL_STRASSE");
        DBMap.put(txt_zusatz, "cust_patient_stammdaten_liste:PSL_ZUSATZ");
        DBMap.put(txt_plz, "cust_patient_stammdaten_liste:PSL_PLZ");
        DBMap.put(txt_ort, "cust_patient_stammdaten_liste:PSL_ORT");
        DBMap.put(ns_countrycode, "cust_patient_stammdaten_liste:PSL_COUNTYCODE");
        DBMap.put(rta_bemerkungen, "cust_patient_stammdaten_liste:PSL_BEMERKUNGEN");
        
        DBMap.put(prescriptionsNoFeesUntil, "cust_patient_stammdaten_liste:PSL_NO_FEES_UNTIL");
        DBMap.put(prescriptionsPermanentGrantUntil, "cust_patient_stammdaten_liste:PSL_PERM_GRANT_UNTIL");
        
        // DBMap.put(txt_username,"cms_auth_stammdaten_user:AUL_USERNAME");

    }

    private void Forms_Fill() {
        db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();

        /******************************** Table ****************************************/
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_patient_stammdaten_liste");
        /******************************************************************************/
        /******************************** Filter ****************************************/
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_patient_stammdaten_liste", "PSL_ID", "=", Form_ID, "");
        /******************************************************************************/

        Container con = db.DB_Data_Get.DB_SEND_AND_GET_Container();
        
        dataSetComparator = DataSetComparator.dbMapHelper(MyUtils.getFirstItemFromContainer(con), DBMap);
        
        fb = new Form_Bind();

        for (Object ItemIda : con.getItemIds()) {
            fb.Get_and_Fill(con, DBMap);
        }
    }

    private int Forms_Insert() {
        db = new DBClass();
        fb = new Form_Bind();
        fb.Insert(db, DBMap);
        /******************************** Table ****************************************/
        db.DB_Data_Insert.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_patient_stammdaten_liste");
        /******************************************************************************/

        return db.DB_Data_Insert.DB_Insert();
    }

    private void Forms_Update() {
        db = new DBClass();
        fb = new Form_Bind();
        fb.Update(db, DBMap);

        /******************************** Table ****************************************/
        db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_patient_stammdaten_liste");
        /******************************************************************************/
        /******************************** Filter ****************************************/
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cust_patient_stammdaten_liste", "PSL_ID", "=", Form_ID, "");
        /******************************************************************************/
        db.DB_Data_Update.DB_Update();
    }

    /***********************************************/

    @SuppressWarnings("rawtypes")
    private void generateMailCheckList() {
        mailCheckFields = new ArrayList<AbstractField>();
        
        mailCheckFields.add(txt_vorname);
        mailCheckFields.add(txt_name);
        mailCheckFields.add(ns_anrede);
        
        mailCheckFields.add(txt_strasse);
        mailCheckFields.add(txt_zusatz);
        mailCheckFields.add(txt_plz);
        mailCheckFields.add(txt_ort);
        mailCheckFields.add(ns_countrycode);
        
        mailCheckFields.add(txt_tel);
        mailCheckFields.add(txt_handy);
        mailCheckFields.add(txt_email);
        
    }
    

    /*********************** -->Validierung<-- ********************/
    private void Set_Validate_Map() {
        ValidateMap = new HashMap<>();

        ValidateMap.put(ns_krankenkasse, "ns_krankenkasse");
        ValidateMap.put(ns_anrede, "ns_anrede");
        ValidateMap.put(txt_titel, "txt_titel");
        ValidateMap.put(txt_name, "txt_name");
        ValidateMap.put(txt_vorname, "txt_vorname");
        ValidateMap.put(pop_geb, "pop_geb");
        ValidateMap.put(txt_tel, "txt_tel");
        ValidateMap.put(txt_handy, "txt_handy");
        ValidateMap.put(txt_email, "txt_email");
        ValidateMap.put(txt_strasse, "txt_strasse");
        ValidateMap.put(txt_zusatz, "txt_zusatz");
        ValidateMap.put(txt_plz, "txt_plz");
        ValidateMap.put(txt_ort, "txt_ort");
        ValidateMap.put(ns_countrycode, "ns_countrycode");

    }

    private void Set_Validierer() {

        txt_tel.addValidator(new Custom_Validator_tel());
        txt_handy.addValidator(new Custom_Validator_tel());
//        txt_email.addValidator(new EmailValidator("Eingabe entspricht keiner Emailadresse !"));
        txt_email.addValidator(new CustomEmailValidator("Eingabe entspricht keiner Emailadresse !"));
        txt_plz.addValidator(new Custom_Validator_plz());
        // psw_pass_1.addValidator(new Custom_Benutzerform_psw_ändern(psw_pass_1, psw_pass_2));

    }

    private boolean Validate_Test() {
        val_checker4 val = new val_checker4(ValidateMap);
        if (val.Is_Valid() == false) {
            return false;
        } else {
            return true;
        }

    }

    private void checkMailNotifications() {

        if(dataSetComparator == null) {
            return;
        }
        
        boolean sendMail = false;
        
        HashMap<AbstractField<?>, Pair<Object, Object>> changes = dataSetComparator.getChanges();
        
        for (AbstractField<?> field : mailCheckFields) {
            if(changes.containsKey(field)) {
                sendMail = true;
                break;
            }
        }
        
        if(sendMail) {
            
            TemplatingRenderer render = new TemplatingRenderer();
            render.loadTemplate("tpl_patient_info");
            
            
            
            render.with("patientName", ns_anrede.getItemCaption(ns_anrede.getValue()) + " "
                + txt_titel.getValue() + " "
                + txt_vorname.getValue() + " "
                + txt_name.getValue());
            
            render.with("street", replaceWithNull(txt_strasse.getValue()));
            render.with("additional", replaceWithNull(txt_zusatz.getValue()));
            render.with("plz", replaceWithNull(txt_plz.getValue()));
            render.with("city", replaceWithNull(txt_ort.getValue()));
            render.with("country", replaceWithNull(ns_countrycode.getItemCaption(ns_countrycode.getValue())));
            
            render.with("phone", replaceWithNull(txt_tel.getValue()));
            render.with("mobile", replaceWithNull(txt_handy.getValue()));
            render.with("mail", replaceWithNull(txt_email.getValue()));
            
            render.with("user", UserData.get().getUserName());
            
            HashMap<String, Object[]> values = new HashMap<String, Object[]>();
            
            for (Entry<AbstractField<?>, Pair<Object, Object>> entry : changes.entrySet()) {
                if(mailCheckFields.contains(entry.getKey()) && entry.getKey() != null && entry.getKey().getCaption() != null) {
                    values.put(entry.getKey().getCaption(), new Object[]{replaceWithNull(entry.getValue().getLeft()), replaceWithNull(entry.getValue().getRight())});
                }
            }
            render.with("changes", values);
            
            Mailer mail = new Mailer(CMS_Config_Std.getInstance());
            mail.setSender("kundenservice@hah.de.com");
            mail.setSubject("Hinweis zu Patientendaten");
            mail.setType(MAIL_TYPE.HTML);
            mail.addAll(new MailerGroup("patient_info"));
            mail.setContent(render.render());
            
            mail.send();
        }
        
    }
    
    private String replaceWithNull(Object value) {
        if(MyUtils.equalsWithNulls(value, "")) {
            value = null;
        }
        return value != null ? value.toString() : null;
    }
    
    // **********************->Füllen ns <-***************/

    private void Anrede_holen() {
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_anrede");

        nativecombo nc = new nativecombo(db.DB_Data_Get.DB_SEND_AND_GET(), ns_anrede, "ASA_ID", "ASA_NAME");
        ns_anrede.setInvalidAllowed(false);
        db.DB_Data_Get.connclose();

    }

    private void Krankenkasse_holen() {
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_kostentraeger_stammdaten");

        nativecombo nc = new nativecombo(db.DB_Data_Get.DB_SEND_AND_GET(), ns_krankenkasse, "CK_ID", "CK_NAME");
        ns_krankenkasse.setInvalidAllowed(false);
        db.DB_Data_Get.connclose();

    }

    private void fillCountrycode() {
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_countrycodes");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_countrycodes", "CC_LNG", "=", "1", "");

        nativecombo nc = new nativecombo(db.DB_Data_Get.DB_SEND_AND_GET(), ns_countrycode, "CC_CODE", "CC_TEXT");

        db.DB_Data_Get.connclose();
    }

    // ****************-> Spez <------****/
    private void Neue_Email() {

        if (txt_email.getValue().toString() != "") {
            String Script = "document.location.href=\"MailTo:" + txt_email.getValue().toString() + "\"";
            UI.getCurrent().getPage().getJavaScript().execute(Script);
            return;
        } else {

            I18nManager.global(I18nGlobalNotifiers.missing_mail);

            return;
        }
    }

    private void Adresse_in_Goolemaps_Anzeigen() {
        if (txt_plz.getValue().toString() != "" && txt_strasse.getValue().toString() != "" && txt_ort.getValue().toString() != "") {
            String str = txt_strasse.getValue().toString();
            // "Brandenburgerstr.+34"

            UI.getCurrent().getUI().getPage().open(new ExternalResource("http://maps.google.de/maps?q=" + str + ",+" + txt_plz.getValue().toString() + "+" + txt_ort.getValue().toString() + ",+Germany"), // URL
                    "_blank", false);

        } else {

            I18nManager.global(I18nGlobalNotifiers.missing_address);

            return;
        }
    }

    @AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");
		mainLayout.setMargin(true);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");
		
		// horizontalLayout_1
		horizontalLayout_1 = buildHorizontalLayout_1();
		mainLayout.addComponent(horizontalLayout_1);
		mainLayout.setExpandRatio(horizontalLayout_1, 10.0f);
		mainLayout.setComponentAlignment(horizontalLayout_1, new Alignment(20));
		
		// horizontalLayout_3
		horizontalLayout_3 = buildHorizontalLayout_3();
		mainLayout.addComponent(horizontalLayout_3);
		mainLayout.setExpandRatio(horizontalLayout_3, 1.0f);
		mainLayout.setComponentAlignment(horizontalLayout_3, new Alignment(20));
		
		return mainLayout;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_1() {
		// common part: create layout
		horizontalLayout_1 = new HorizontalLayout();
		horizontalLayout_1.setImmediate(false);
		horizontalLayout_1.setWidth("100.0%");
		horizontalLayout_1.setHeight("100.0%");
		horizontalLayout_1.setMargin(false);
		
		// verticalLayout_2
		verticalLayout_2 = buildVerticalLayout_2();
		horizontalLayout_1.addComponent(verticalLayout_2);
		horizontalLayout_1.setExpandRatio(verticalLayout_2, 1.0f);
		
		// verticalLayout_5
		verticalLayout_5 = buildVerticalLayout_5();
		horizontalLayout_1.addComponent(verticalLayout_5);
		horizontalLayout_1.setExpandRatio(verticalLayout_5, 2.0f);
		
		return horizontalLayout_1;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_2() {
		// common part: create layout
		verticalLayout_2 = new VerticalLayout();
		verticalLayout_2.setImmediate(false);
		verticalLayout_2.setWidth("100.0%");
		verticalLayout_2.setHeight("100.0%");
		verticalLayout_2.setMargin(false);
		
		// pan_ind_id
		pan_ind_id = buildPan_ind_id();
		verticalLayout_2.addComponent(pan_ind_id);
		verticalLayout_2.setExpandRatio(pan_ind_id, 0.5f);
		verticalLayout_2.setComponentAlignment(pan_ind_id, new Alignment(20));
		
		// pan_grundaten
		pan_grundaten = buildPan_grundaten();
		verticalLayout_2.addComponent(pan_grundaten);
		verticalLayout_2.setExpandRatio(pan_grundaten, 1.2f);
		verticalLayout_2.setComponentAlignment(pan_grundaten, new Alignment(20));
		
		return verticalLayout_2;
	}

	@AutoGenerated
	private Panel buildPan_ind_id() {
		// common part: create layout
		pan_ind_id = new Panel();
		pan_ind_id.setCaption("Indendifikations Nummern");
		pan_ind_id.setImmediate(false);
		pan_ind_id.setWidth("80.0%");
		pan_ind_id.setHeight("120px");
		
		// verticalLayout_3
		verticalLayout_3 = buildVerticalLayout_3();
		pan_ind_id.setContent(verticalLayout_3);
		
		return pan_ind_id;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_3() {
		// common part: create layout
		verticalLayout_3 = new VerticalLayout();
		verticalLayout_3.setImmediate(false);
		verticalLayout_3.setWidth("100.0%");
		verticalLayout_3.setHeight("100.0%");
		verticalLayout_3.setMargin(false);
		
		// ns_krankenkasse
		ns_krankenkasse = new NativeSelect();
		ns_krankenkasse.setCaption("Krankenkasse");
		ns_krankenkasse.setImmediate(false);
		ns_krankenkasse.setWidth("165px");
		ns_krankenkasse.setHeight("-1px");
		verticalLayout_3.addComponent(ns_krankenkasse);
		verticalLayout_3.setComponentAlignment(ns_krankenkasse, new Alignment(48));
		
		return verticalLayout_3;
	}

	@AutoGenerated
	private Panel buildPan_grundaten() {
		// common part: create layout
		pan_grundaten = new Panel();
		pan_grundaten.setCaption("Grundaten");
		pan_grundaten.setImmediate(false);
		pan_grundaten.setWidth("80.0%");
		pan_grundaten.setHeight("100.0%");
		
		// verticalLayout_4
		verticalLayout_4 = buildVerticalLayout_4();
		pan_grundaten.setContent(verticalLayout_4);
		
		return pan_grundaten;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_4() {
		// common part: create layout
		verticalLayout_4 = new VerticalLayout();
		verticalLayout_4.setImmediate(false);
		verticalLayout_4.setWidth("100.0%");
		verticalLayout_4.setHeight("100.0%");
		verticalLayout_4.setMargin(false);
		
		// txt_titel
		txt_titel = new TextField();
		txt_titel.setCaption("Titel");
		txt_titel.setImmediate(false);
		txt_titel.setWidth("-1px");
		txt_titel.setHeight("-1px");
		verticalLayout_4.addComponent(txt_titel);
		verticalLayout_4.setComponentAlignment(txt_titel, new Alignment(48));
		
		// ns_anrede
		ns_anrede = new NativeSelect();
		ns_anrede.setCaption("Anrede");
		ns_anrede.setImmediate(false);
		ns_anrede.setWidth("165px");
		ns_anrede.setHeight("-1px");
		verticalLayout_4.addComponent(ns_anrede);
		verticalLayout_4.setComponentAlignment(ns_anrede, new Alignment(48));
		
		// txt_name
		txt_name = new TextField();
		txt_name.setCaption("Name");
		txt_name.setImmediate(false);
		txt_name.setWidth("-1px");
		txt_name.setHeight("-1px");
		verticalLayout_4.addComponent(txt_name);
		verticalLayout_4.setComponentAlignment(txt_name, new Alignment(48));
		
		// txt_vorname
		txt_vorname = new TextField();
		txt_vorname.setCaption("Vorname");
		txt_vorname.setImmediate(false);
		txt_vorname.setWidth("-1px");
		txt_vorname.setHeight("-1px");
		verticalLayout_4.addComponent(txt_vorname);
		verticalLayout_4.setComponentAlignment(txt_vorname, new Alignment(48));
		
		// pop_geb
		pop_geb = new PopupDateField();
		pop_geb.setCaption("Geburtstag");
		pop_geb.setImmediate(false);
		pop_geb.setWidth("165px");
		pop_geb.setHeight("-1px");
		verticalLayout_4.addComponent(pop_geb);
		verticalLayout_4.setComponentAlignment(pop_geb, new Alignment(48));
		
		return verticalLayout_4;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_5() {
		// common part: create layout
		verticalLayout_5 = new VerticalLayout();
		verticalLayout_5.setImmediate(false);
		verticalLayout_5.setWidth("100.0%");
		verticalLayout_5.setHeight("100.0%");
		verticalLayout_5.setMargin(false);
		verticalLayout_5.setSpacing(true);
		
		// horizontalLayout_2
		horizontalLayout_2 = buildHorizontalLayout_2();
		verticalLayout_5.addComponent(horizontalLayout_2);
		verticalLayout_5.setExpandRatio(horizontalLayout_2, 1.0f);
		verticalLayout_5.setComponentAlignment(horizontalLayout_2, new Alignment(48));
		
		// tabs
		tabs = buildTabs();
		verticalLayout_5.addComponent(tabs);
		verticalLayout_5.setExpandRatio(tabs, 1.0f);
		
		return verticalLayout_5;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_2() {
		// common part: create layout
		horizontalLayout_2 = new HorizontalLayout();
		horizontalLayout_2.setImmediate(false);
		horizontalLayout_2.setWidth("100.0%");
		horizontalLayout_2.setHeight("100.0%");
		horizontalLayout_2.setMargin(false);
		
		// verticalLayout_6
		verticalLayout_6 = buildVerticalLayout_6();
		horizontalLayout_2.addComponent(verticalLayout_6);
		horizontalLayout_2.setExpandRatio(verticalLayout_6, 1.0f);
		horizontalLayout_2.setComponentAlignment(verticalLayout_6, new Alignment(20));
		
		// verticalLayout_7
		verticalLayout_7 = buildVerticalLayout_7();
		horizontalLayout_2.addComponent(verticalLayout_7);
		horizontalLayout_2.setExpandRatio(verticalLayout_7, 1.0f);
		horizontalLayout_2.setComponentAlignment(verticalLayout_7, new Alignment(20));
		
		return horizontalLayout_2;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_6() {
		// common part: create layout
		verticalLayout_6 = new VerticalLayout();
		verticalLayout_6.setImmediate(false);
		verticalLayout_6.setWidth("100.0%");
		verticalLayout_6.setHeight("100.0%");
		verticalLayout_6.setMargin(false);
		
		// pan_erreichbarkeit
		pan_erreichbarkeit = buildPan_erreichbarkeit();
		verticalLayout_6.addComponent(pan_erreichbarkeit);
		verticalLayout_6.setExpandRatio(pan_erreichbarkeit, 3.5f);
		verticalLayout_6.setComponentAlignment(pan_erreichbarkeit, new Alignment(20));
		
		return verticalLayout_6;
	}

	@AutoGenerated
	private Panel buildPan_erreichbarkeit() {
		// common part: create layout
		pan_erreichbarkeit = new Panel();
		pan_erreichbarkeit.setCaption("Erreichbarkeit");
		pan_erreichbarkeit.setImmediate(false);
		pan_erreichbarkeit.setWidth("80.0%");
		pan_erreichbarkeit.setHeight("80.0%");
		
		// verticalLayout_8
		verticalLayout_8 = buildVerticalLayout_8();
		pan_erreichbarkeit.setContent(verticalLayout_8);
		
		return pan_erreichbarkeit;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_8() {
		// common part: create layout
		verticalLayout_8 = new VerticalLayout();
		verticalLayout_8.setImmediate(false);
		verticalLayout_8.setWidth("100.0%");
		verticalLayout_8.setHeight("100.0%");
		verticalLayout_8.setMargin(false);
		
		// txt_tel
		txt_tel = new TextField();
		txt_tel.setCaption("Telefon");
		txt_tel.setImmediate(false);
		txt_tel.setWidth("-1px");
		txt_tel.setHeight("-1px");
		verticalLayout_8.addComponent(txt_tel);
		verticalLayout_8.setComponentAlignment(txt_tel, new Alignment(48));
		
		// txt_handy
		txt_handy = new TextField();
		txt_handy.setCaption("Handy");
		txt_handy.setImmediate(false);
		txt_handy.setWidth("-1px");
		txt_handy.setHeight("-1px");
		verticalLayout_8.addComponent(txt_handy);
		verticalLayout_8.setComponentAlignment(txt_handy, new Alignment(48));
		
		// txt_email
		txt_email = new TextField();
		txt_email.setCaption("Email");
		txt_email.setImmediate(false);
		txt_email.setWidth("-1px");
		txt_email.setHeight("-1px");
		verticalLayout_8.addComponent(txt_email);
		verticalLayout_8.setComponentAlignment(txt_email, new Alignment(48));
		
		// btn_email_send
		btn_email_send = new Button();
		btn_email_send.setCaption("Email Senden");
		btn_email_send.setImmediate(true);
		btn_email_send.setWidth("-1px");
		btn_email_send.setHeight("-1px");
		verticalLayout_8.addComponent(btn_email_send);
		verticalLayout_8.setComponentAlignment(btn_email_send, new Alignment(48));
		
		return verticalLayout_8;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_7() {
		// common part: create layout
		verticalLayout_7 = new VerticalLayout();
		verticalLayout_7.setImmediate(false);
		verticalLayout_7.setWidth("100.0%");
		verticalLayout_7.setHeight("100.0%");
		verticalLayout_7.setMargin(false);
		
		// pan_anschrift
		pan_anschrift = buildPan_anschrift();
		verticalLayout_7.addComponent(pan_anschrift);
		verticalLayout_7.setExpandRatio(pan_anschrift, 3.5f);
		verticalLayout_7.setComponentAlignment(pan_anschrift, new Alignment(20));
		
		return verticalLayout_7;
	}

	@AutoGenerated
	private Panel buildPan_anschrift() {
		// common part: create layout
		pan_anschrift = new Panel();
		pan_anschrift.setCaption("Anschrift");
		pan_anschrift.setImmediate(false);
		pan_anschrift.setWidth("80.0%");
		pan_anschrift.setHeight("100.0%");
		
		// verticalLayout_9
		verticalLayout_9 = buildVerticalLayout_9();
		pan_anschrift.setContent(verticalLayout_9);
		
		return pan_anschrift;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_9() {
		// common part: create layout
		verticalLayout_9 = new VerticalLayout();
		verticalLayout_9.setImmediate(false);
		verticalLayout_9.setWidth("100.0%");
		verticalLayout_9.setHeight("100.0%");
		verticalLayout_9.setMargin(false);
		
		// txt_strasse
		txt_strasse = new TextField();
		txt_strasse.setCaption("Strasse");
		txt_strasse.setImmediate(false);
		txt_strasse.setWidth("-1px");
		txt_strasse.setHeight("-1px");
		verticalLayout_9.addComponent(txt_strasse);
		verticalLayout_9.setComponentAlignment(txt_strasse, new Alignment(48));
		
		// txt_zusatz
		txt_zusatz = new TextField();
		txt_zusatz.setCaption("Adresszusatz");
		txt_zusatz.setImmediate(false);
		txt_zusatz.setWidth("-1px");
		txt_zusatz.setHeight("-1px");
		verticalLayout_9.addComponent(txt_zusatz);
		verticalLayout_9.setComponentAlignment(txt_zusatz, new Alignment(48));
		
		// txt_plz
		txt_plz = new TextField();
		txt_plz.setCaption("PLZ");
		txt_plz.setImmediate(false);
		txt_plz.setWidth("-1px");
		txt_plz.setHeight("-1px");
		verticalLayout_9.addComponent(txt_plz);
		verticalLayout_9.setComponentAlignment(txt_plz, new Alignment(48));
		
		// txt_ort
		txt_ort = new TextField();
		txt_ort.setCaption("Ort");
		txt_ort.setImmediate(false);
		txt_ort.setWidth("-1px");
		txt_ort.setHeight("-1px");
		verticalLayout_9.addComponent(txt_ort);
		verticalLayout_9.setComponentAlignment(txt_ort, new Alignment(48));
		
		// ns_countrycode
		ns_countrycode = new NativeSelect();
		ns_countrycode.setCaption("Land");
		ns_countrycode.setImmediate(false);
		ns_countrycode.setWidth("-1px");
		ns_countrycode.setHeight("-1px");
		verticalLayout_9.addComponent(ns_countrycode);
		verticalLayout_9.setComponentAlignment(ns_countrycode, new Alignment(48));
		
		// btn_maps
		btn_maps = new Button();
		btn_maps.setCaption("Google Maps");
		btn_maps.setImmediate(true);
		btn_maps.setWidth("-1px");
		btn_maps.setHeight("-1px");
		verticalLayout_9.addComponent(btn_maps);
		verticalLayout_9.setComponentAlignment(btn_maps, new Alignment(48));
		
		return verticalLayout_9;
	}

	@AutoGenerated
	private TabSheet buildTabs() {
		// common part: create layout
		tabs = new TabSheet();
		tabs.setImmediate(true);
		tabs.setWidth("100.0%");
		tabs.setHeight("100.0%");
		
		// rta_bemerkungen
		rta_bemerkungen = new RichTextArea();
		rta_bemerkungen.setImmediate(false);
		rta_bemerkungen.setWidth("100.0%");
		rta_bemerkungen.setHeight("100.0%");
		tabs.addTab(rta_bemerkungen, "Bemerkungen", null);
		
		// layoutPrescriptions2
		layoutPrescriptions2 = buildLayoutPrescriptions2();
		tabs.addTab(layoutPrescriptions2, "Rezeptdaten", null);
		
		// monitoringFirms
		monitoringFirms = new PatientMonitoringFirmsComponent();
		monitoringFirms.setImmediate(false);
		monitoringFirms.setWidth("100.0%");
		monitoringFirms.setHeight("100.0%");
		tabs.addTab(monitoringFirms, "monitoring_firms", null);
		
		return tabs;
	}

	@AutoGenerated
	private HorizontalLayout buildLayoutPrescriptions2() {
		// common part: create layout
		layoutPrescriptions2 = new HorizontalLayout();
		layoutPrescriptions2.setImmediate(false);
		layoutPrescriptions2.setWidth("100.0%");
		layoutPrescriptions2.setHeight("100.0%");
		layoutPrescriptions2.setMargin(true);
		layoutPrescriptions2.setSpacing(true);
		
		// verticalLayout_10
		verticalLayout_10 = buildVerticalLayout_10();
		layoutPrescriptions2.addComponent(verticalLayout_10);
		layoutPrescriptions2.setComponentAlignment(verticalLayout_10, new Alignment(48));
		
		return layoutPrescriptions2;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_10() {
		// common part: create layout
		verticalLayout_10 = new VerticalLayout();
		verticalLayout_10.setImmediate(false);
		verticalLayout_10.setWidth("100.0%");
		verticalLayout_10.setHeight("100.0%");
		verticalLayout_10.setMargin(false);
		
		// prescriptionsNoFeesUntil
		prescriptionsNoFeesUntil = new PopupDateField();
		prescriptionsNoFeesUntil.setCaption("Gebührenbefreit bis");
		prescriptionsNoFeesUntil.setImmediate(false);
		prescriptionsNoFeesUntil.setWidth("-1px");
		prescriptionsNoFeesUntil.setHeight("-1px");
		verticalLayout_10.addComponent(prescriptionsNoFeesUntil);
		verticalLayout_10.setComponentAlignment(prescriptionsNoFeesUntil, new Alignment(33));
		
		// prescriptionsPermanentGrantUntil
		prescriptionsPermanentGrantUntil = new PopupDateField();
		prescriptionsPermanentGrantUntil.setCaption("Dauerbewilligt bis");
		prescriptionsPermanentGrantUntil.setImmediate(false);
		prescriptionsPermanentGrantUntil.setWidth("-1px");
		prescriptionsPermanentGrantUntil.setHeight("-1px");
		verticalLayout_10.addComponent(prescriptionsPermanentGrantUntil);
		verticalLayout_10.setComponentAlignment(prescriptionsPermanentGrantUntil, new Alignment(33));
		
		return verticalLayout_10;
	}

	@AutoGenerated
	private HorizontalLayout buildHorizontalLayout_3() {
		// common part: create layout
		horizontalLayout_3 = new HorizontalLayout();
		horizontalLayout_3.setImmediate(false);
		horizontalLayout_3.setWidth("100.0%");
		horizontalLayout_3.setHeight("100.0%");
		horizontalLayout_3.setMargin(true);
		
		// btn_zuw_arzt
		btn_zuw_arzt = new Button();
		btn_zuw_arzt.setCaption("Behandelte Ärzte");
		btn_zuw_arzt.setImmediate(true);
		btn_zuw_arzt.setWidth("-1px");
		btn_zuw_arzt.setHeight("-1px");
		horizontalLayout_3.addComponent(btn_zuw_arzt);
		horizontalLayout_3.setComponentAlignment(btn_zuw_arzt, new Alignment(48));
		
		// btn_save
		btn_save = new Button();
		btn_save.setCaption("Speichern");
		btn_save.setImmediate(true);
		btn_save.setWidth("-1px");
		btn_save.setHeight("-1px");
		horizontalLayout_3.addComponent(btn_save);
		horizontalLayout_3.setComponentAlignment(btn_save, new Alignment(48));
		
		return horizontalLayout_3;
	}

}
