package archenoah.web.normal.Login;

import java.io.UnsupportedEncodingException;
import java.security.NoSuchAlgorithmException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

import archenoah.config.CMS_Config_Std;
import archenoah.lib.custom.MyUtils;
import archenoah.lib.tool.comunication.dbclass.DBClass;
import archenoah.lib.tool.comunication.dbclass.DBClass.CustomQuery;
import archenoah.lib.tool.comunication.dbclass.SanitizeMySQL;
import archenoah.lib.tool.encryption.sha1.Crypt_SHA1;
import archenoah.lib.vaadin.Language.i18n.I18nCB;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalNotifiers;
import archenoah.lib.vaadin.Language.i18n.I18nManager;
import archenoah.lib.vaadin.Language.i18n.I18nNB;
import archenoah.lib.vaadin.Logger.Logger;
import archenoah.lib.vaadin.valchecker.val_checker;
import archenoah.web.normal.application_watcher.Thread_Session_Wächter;
import archenoah.web.normal.application_watcher.Thread_Watcher;
import archenoah.web.normal.main.Constructor;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.data.util.sqlcontainer.SQLContainer;
import com.vaadin.event.ShortcutAction.KeyCode;
import com.vaadin.server.Page;
import com.vaadin.server.ThemeResource;
import com.vaadin.server.WebBrowser;
import com.vaadin.shared.ui.combobox.FilteringMode;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.Button.ClickShortcut;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Embedded;
import com.vaadin.ui.PasswordField;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

public class frm_login extends CustomComponent {

    /*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

    @AutoGenerated
    private VerticalLayout mainLayout;
    @AutoGenerated
    private Button login;
    @AutoGenerated
    private ComboBox locale;
    @AutoGenerated
    private VerticalLayout verticalLayout_2;
    @AutoGenerated
    private PasswordField password;
    @AutoGenerated
    private TextField user;
    @AutoGenerated
    private Embedded Login_Logo;
    private Window Login;

    private static int WARNING_PERIOD_MINS = 3;
    private final WebBrowser webBrowser;
    private boolean Touch;
    private final String Session;
    private int U_ID;

    private String Username = "";

    private Logger log;
    
    private I18nManager i18n;
    
    private final static class caption extends I18nCB{
        final static I18nCB window_title = set();
    }
    
    private final static class notifier extends I18nNB{
        
        final static I18nNB login_failed = set(ERROR, MC, 1); // #2
        final static I18nNB user_already_signed_in = set(ERROR, MC, 1); // #4
    }
    
    /**
     * The constructor should first build the main layout, set the composition
     * root and then do any custom initialization.
     * 
     * The constructor will not be automatically regenerated by the visual
     * editor.
     */

    public Map<Object, String> LNG_Map;
    public Map<Object, String> Val_Map;

    public frm_login() {

        buildMainLayout();
        i18n = new I18nManager(this);
        
        // setCompositionRoot(mainLayout);
        Login_Logo.setSource(new ThemeResource("image-res/images/Login.png"));

        Login_Logo.setHeight("100px");
        Login_Logo.setWidth("100px");

        CMS_Config_Std std = CMS_Config_Std.getInstance();
        WARNING_PERIOD_MINS = Integer.valueOf(std.Session_Warnung_Time_Out);

        UI.getCurrent().getSession().getSession().setMaxInactiveInterval(Integer.valueOf(std.Session_Time_Out) * 60);

        webBrowser = Page.getCurrent().getWebBrowser();

        Session = UI.getCurrent().getSession().getSession().getId();

        log = new Logger();

        /**************** Session Erstellen bzw. Bearbeiten ***********/

        if (SessionVorhanden(UI.getCurrent().getSession().getSession().getId()) == 0) {
            SessionErstellen(UI.getCurrent().getSession().getSession().getId(), webBrowser.getAddress());
        } else {
            SessionUpdate(UI.getCurrent().getSession().getSession().getId());
        }

        Thread_Session_Wächter tsw = new Thread_Session_Wächter(Username);

        tsw.start();

        Aufbau_Window();

        Event_Forms();

        VAL_Map_Fill();
        
        Login.setClosable(false);

    }


    private void Aufbau_Window() {
        Login = new Window("login_title");
        Login.setModal(true);
        Login.setResizable(false);
        Login.setContent(mainLayout);
        Login.center();
        Login.setStyleName("login");
        Login.setDraggable(false);
        Login.setClosable(false);
        Login.setHeight("450px");
        Login.setWidth("350px");
        UI.getCurrent().addWindow(Login);
        locale.setFilteringMode(FilteringMode.OFF);
        Login.addAction(new ClickShortcut(login, KeyCode.ENTER));
        user.focus();

    }
    
    private void VAL_Map_Fill() {
        Val_Map = new HashMap<>();
        Val_Map.put(user, "user");
        Val_Map.put(password, "password");
    }

    
    @SuppressWarnings("serial")
    private void Event_Forms() {
        
        locale.setImmediate(true);
        locale.setNullSelectionAllowed(false);
        locale.setItemCaptionPropertyId("CAPTION");
        locale.setContainerDataSource(dbGetLocales());
        locale.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                UI.getCurrent().setLocale(new Locale((String) event.getProperty().getValue()));
                i18n.changeComponentLanguage(UI.getCurrent().getLocale());
                Page.getCurrent().setTitle(i18n.get(caption.window_title));
                
            }
        });
        locale.setValue(UI.getCurrent().getLocale().getLanguage());
        
        
        login.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {
                // TODO Automatisch generierter Methodenstub

                val_checker val = new val_checker(Val_Map);

                if (val.Is_Valid() == false) {

                    I18nManager.global(I18nGlobalNotifiers.fields_empty);
                    return; 
                    
                }
                
                int Login_test_ID = Login_Test();

                if (Login_test_ID == 0) {
                    i18n.notifier(notifier.login_failed);

                    WebBrowser webBrowser = UI.getCurrent().getSession().getBrowser();

                    Thread_Watcher tiw = new Thread_Watcher(webBrowser.getAddress(), SanitizeMySQL.escape(user.getValue()));
                    tiw.run();

                    return;

                }

                log = new Logger();
                log.Logging_Info("3", "Der Benutzer: \"" + SanitizeMySQL.escape(user.getValue()) + "\" hat sich Angemeldet.", webBrowser.getAddress(), Session);

                UI.getCurrent().removeWindow(Login);

                if (Login_test_ID == 1) {

                    new frm_passwortedit();
                    return;

                }
                if (Login_test_ID == 2) {
                    new Constructor();
                    return;
                }

                if (Login_test_ID == 3) {
                    i18n.notifier(notifier.user_already_signed_in);
                    return;

                }

            }
        });

    }

    /******************* Session **********************/
    private int SessionVorhanden(String Session) {
        CMS_Config_Std conf = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_liste");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_SESSION_ID", "=", "'" + Session + "'", "AND");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_STATUS_ID", "=", "1", "");

        Container con = db.DB_Data_Get.DB_SEND_AND_GET_Container();

        try {
            if (con == null | con.size() == 0) {
                return 0;
            }

            for (Object ItemIda : con.getItemIds()) {
                // UserId = (int)
                // result.getItem(ItemIda).getItemProperty(this.Spalte_ID)
                // .getValue();
                return (int) con.getItem(ItemIda).getItemProperty("CSL_ID").getValue();
            }
        } catch (Exception e) {
            // TODO Automatisch generierter Erfassungsblock
            return 0;
        }
        return 0;

    }

    private void SessionErstellen(String Session, String IPAdresse) {
        if (IPAdresse.equals("0:0:0:0:0:0:0:1")) {
            IPAdresse = "127.0.0.1";

        }

        Date d = new Date();

        DateFormat dfa = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

        String Datum_Uhrzeit = dfa.format(d);
        ;

        DBClass db = new DBClass();
        db.DB_Data_Insert.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_liste");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_CREATE_DATE", Datum_Uhrzeit);
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_SESSION_ID", Session);
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_USER_ID", "0");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_IP_ADRESSE", IPAdresse);
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_LAST_AKT", Datum_Uhrzeit);
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_liste", "CSL_STATUS_ID", "1");
        Integer IJ = db.DB_Data_Insert.DB_Insert();

        db = new DBClass();
        db.DB_Data_Insert.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_zusatzliste");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_S_ID", IJ + "");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_OS_NAME", getOperatingSystem(webBrowser));
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_BROWSER_INFO", getBrowserAndVersion(webBrowser));
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_LOCATION", webBrowser.getLocale().getCountry());
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_TOUCH", (webBrowser.isTouchDevice() ? "Mobile" : "Computer"));

        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_BROWSER_HEIGHT", webBrowser.getScreenHeight() + "px");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_BROWSER_WIDTH", webBrowser.getScreenWidth() + "px");
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_HTTPS", (webBrowser.isSecureConnection() ? "Verschlüsselt" : "Unverschlüsselt"));
        db.DB_Data_Insert.DB_Daten.DB_Data("cms_session_zusatzliste", "SZL_TIMEZONE", getTimeZoneInfoString(webBrowser));

        db.DB_Data_Insert.DB_Insert();

    }

    private void SessionUpdate(String Session) {

        Date d = new Date();
        DateFormat dfa = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        String Datum_Uhrzeit = dfa.format(d);
        DBClass db = new DBClass();
        db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_liste");
        db.DB_Data_Update.DB_Daten.DB_Data("cms_session_liste", "CSL_LAST_AKT", Datum_Uhrzeit);
        db.DB_Data_Update.DB_Daten.DB_Data("cms_session_liste", "CSL_USER_ID", "0");
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_SESSION_ID", "=", "'" + Session + "'", "AND");
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_STATUS_ID", "=", "1", "");
        db.DB_Data_Update.DB_Update();
    }

    private void SessionUpdate_UserOnline(String Session, String UID) {

        Date d = new Date();
        DateFormat dfa = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        String Datum_Uhrzeit = dfa.format(d);
        DBClass db = new DBClass();
        db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_liste");
        db.DB_Data_Update.DB_Daten.DB_Data("cms_session_liste", "CSL_LAST_AKT", Datum_Uhrzeit);
        db.DB_Data_Update.DB_Daten.DB_Data("cms_session_liste", "CSL_USER_ID", UID);
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_SESSION_ID", "=", "'" + Session + "'", "AND");
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_STATUS_ID", "=", "1", "");
        db.DB_Data_Update.DB_Update();
    }

    private int Session_Count_User(int UID) {

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_session_liste");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_session_liste", "CSL_USER_ID", "=", "" + UID + "", "");
        Container con = db.DB_Data_Get.DB_SEND_AND_GET_Container();

        if (con.size() == 0) {
            return 0;
        } else {
            return con.size();
        }

    }

    private String getTimeZoneInfoString(WebBrowser webBrowser) {
        // Client timezone offset:
        int tzOffset = webBrowser.getTimezoneOffset();
        String infoStr = String.format(" GMT%s%d", (tzOffset < 0 ? "-" : "+"), Math.abs(tzoToHours(tzOffset)));
        if (webBrowser.isDSTInEffect()) {
            infoStr += String.format(" and DST %d", tzoToHours(webBrowser.getDSTSavings()));
        }
        return infoStr;
    }

    private static int tzoToHours(int ms) {
        return ms / 1000 / 60 / 60;
    }

    private String getOperatingSystem(WebBrowser webBrowser) {
        if (webBrowser.isWindows()) {
            return "Windows";
        } else if (webBrowser.isMacOSX()) {
            return "Mac OSX";
        } else if (webBrowser.isLinux()) {
            return "Linux";
        } else {
            return "an unknown operating system";
        }
    }

    private String getBrowserAndVersion(WebBrowser webBrowser) {
        if (webBrowser.isChrome()) {
            return "Chrome " + webBrowser.getBrowserMajorVersion() + "." + webBrowser.getBrowserMinorVersion();
        } else if (webBrowser.isOpera()) {
            return "Opera " + webBrowser.getBrowserMajorVersion() + "." + webBrowser.getBrowserMinorVersion();
        } else if (webBrowser.isFirefox()) {
            return "Firefox " + webBrowser.getBrowserMajorVersion() + "." + webBrowser.getBrowserMinorVersion();
        } else if (webBrowser.isSafari()) {
            return "Safari " + webBrowser.getBrowserMajorVersion() + "." + webBrowser.getBrowserMinorVersion();
        } else if (webBrowser.isIE()) {
            return "Internet Explorer " + webBrowser.getBrowserMajorVersion();
        } else {
            return "an unknown browser";
        }
    }

    /**************************************************/

    /**************** LOGIN *****************************/
    private int Login_Test() {

        String user = SanitizeMySQL.escape(this.user.getValue());
        String password = this.password.getValue();
        
        try {
            password = Crypt_SHA1.SHA512(user + password + "6545465258552455554424");

        } catch (NoSuchAlgorithmException ex) {
            System.out.println(ex.getMessage());
        } catch (UnsupportedEncodingException ex) {
            System.out.println(ex.getMessage());
        }

        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("AUL_ID");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("AUL_PASS_RESET");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_user");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_user", "AUL_USERNAME", "=", "'" + user + "'", "AND");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_user", "AUL_PASSWORT", "=", "'" + password + "'", "AND");
        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_user", "AUL_AKTIV", "=", "'1'", "");
        
        SQLContainer con = db.DB_Data_Get.DB_SEND_AND_GET();
        
        

        if (con.size() > 0) {

            for (Object ItemIda : con.getItemIds()) {
                // UserId = (int)
                // result.getItem(ItemIda).getItemProperty(this.Spalte_ID)
                // .getValue();
                // System.out.println(con.getItem(ItemIda).getItemProperty("AUL_ID").getValue().getClass().getName());

                U_ID = (int) con.getItem(ItemIda).getItemProperty("AUL_ID").getValue();

                Username = user;

                if (Session_Count_User(U_ID) >= std.Max_User_GL_Online_Count) {

                    db.DB_Data_Get.connclose();
                    return 3;
                }

                if ((boolean) con.getItem(ItemIda).getItemProperty("AUL_PASS_RESET").getValue() == true) {
                    db.DB_Data_Get.connclose();
                    SessionUpdate_UserOnline(Session, U_ID + "");
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("Userid", U_ID);
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("Username", user);
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("LastLogin", Get_Last_login());
                    MyUtils.setUserData(U_ID);
                    return 1;

                } else {
                    db.DB_Data_Get.connclose();
                    SessionUpdate_UserOnline(Session, U_ID + "");
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("Userid", U_ID);
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("Username", user);
                    UI.getCurrent().getUI().getSession().getSession().setAttribute("LastLogin", Get_Last_login());
                    MyUtils.setUserData(U_ID);
                    return 2;

                }

            }
            
            LoginErfolgreich(user);

        } else {
            db.DB_Data_Get.connclose();
            return 0;
        }
        return 0;

    }

    private void LoginErfolgreich(String Username) {
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_user");
        db.DB_Data_Update.DB_Daten.DB_Data("cms_auth_stammdaten_user", "AUL_LOGIN_ERROR", "0");
        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_user", "AUL_USERNAME", "=", Username, "");
        db.DB_Data_Update.DB_Update();
    }

    /**************************************************/

    private String Get_Last_login() {
        Date dt = null;
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();
        // db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("DATE_FORMAT(MAX(LL_DATE),'%d.%m.%Y %H:%i:%s'","Datum");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("MAX(LL_DATE)", "Datum");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_logger_liste");
        db.DB_Data_Get.DB_Filter.DB_WHERE_LIKE("cms_logger_liste", "LL_NACHRICHT", "'%" + Username + "%'", "");

        Container con_lastlogin = db.DB_Data_Get.DB_SEND_AND_GET_Container();

        for (Object ItemIda : con_lastlogin.getItemIds()) {
            // UserId = (int)
            // result.getItem(ItemIda).getItemProperty(this.Spalte_ID).getValue;
            //
            dt = (Date) con_lastlogin.getItem(ItemIda).getItemProperty("Datum").getValue();

        }
        if (con_lastlogin == null || dt == null) {
            return "Unbekannt";
        }
        DateFormat dfa = new SimpleDateFormat("dd.MM.yyyy HH:mm:ss");
        String Last_login = "";
        Last_login = dfa.format(dt);
        return Last_login;
    }

    private Container dbGetLocales() {
        CustomQuery q = new DBClass().CustomQuery;
        String sql = "select * from cms_i18n_languages order by CAPTION ASC";
        q.setSqlString(sql);
        Container con = q.query();
        
        return MyUtils.convertIndex(con, "LOCALE");
    }
    
    @AutoGenerated
    private VerticalLayout buildMainLayout() {
        // common part: create layout
        mainLayout = new VerticalLayout();
        mainLayout.setImmediate(false);
        mainLayout.setWidth("100%");
        mainLayout.setHeight("100%");
        mainLayout.setMargin(false);
        
        // top-level component properties
        setWidth("100.0%");
        setHeight("100.0%");
        
        // Login_Logo
        Login_Logo = new Embedded();
        Login_Logo.setImmediate(false);
        Login_Logo.setWidth("150px");
        Login_Logo.setHeight("150px");
        Login_Logo.setSource(new ThemeResource("img/component/embedded_icon.png"));
        Login_Logo.setType(1);
        Login_Logo.setMimeType("image/png");
        mainLayout.addComponent(Login_Logo);
        mainLayout.setExpandRatio(Login_Logo, 2.0f);
        mainLayout.setComponentAlignment(Login_Logo, new Alignment(48));
        
        // verticalLayout_2
        verticalLayout_2 = buildVerticalLayout_2();
        mainLayout.addComponent(verticalLayout_2);
        mainLayout.setExpandRatio(verticalLayout_2, 2.0f);
        mainLayout.setComponentAlignment(verticalLayout_2, new Alignment(48));
        
        // locale
        locale = new ComboBox();
        locale.setCaption("locale");
        locale.setImmediate(false);
        locale.setWidth("170px");
        locale.setHeight("-1px");
        mainLayout.addComponent(locale);
        mainLayout.setExpandRatio(locale, 1.0f);
        mainLayout.setComponentAlignment(locale, new Alignment(48));
        
        // login
        login = new Button();
        login.setCaption("login");
        login.setImmediate(true);
        login.setWidth("-1px");
        login.setHeight("-1px");
        login.setTabIndex(5);
        mainLayout.addComponent(login);
        mainLayout.setExpandRatio(login, 1.0f);
        mainLayout.setComponentAlignment(login, new Alignment(48));
        
        return mainLayout;
    }


    @AutoGenerated
    private VerticalLayout buildVerticalLayout_2() {
        // common part: create layout
        verticalLayout_2 = new VerticalLayout();
        verticalLayout_2.setImmediate(false);
        verticalLayout_2.setWidth("-1px");
        verticalLayout_2.setHeight("-1px");
        verticalLayout_2.setMargin(false);
        verticalLayout_2.setSpacing(true);
        
        // user
        user = new TextField();
        user.setCaption("user");
        user.setImmediate(false);
        user.setWidth("170px");
        user.setHeight("-1px");
        user.setTabIndex(1);
        verticalLayout_2.addComponent(user);
        
        // password
        password = new PasswordField();
        password.setCaption("password");
        password.setImmediate(false);
        password.setWidth("170px");
        password.setHeight("-1px");
        password.setTabIndex(2);
        verticalLayout_2.addComponent(password);
        
        return verticalLayout_2;
    }

    // *********************************************/

}
