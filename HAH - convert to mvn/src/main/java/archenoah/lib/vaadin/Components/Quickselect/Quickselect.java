package archenoah.lib.vaadin.Components.Quickselect;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.shared.ui.combobox.FilteringMode;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.MenuBar.MenuItem;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

public class Quickselect extends CustomComponent{
    
    /*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

    @AutoGenerated
    private VerticalLayout mainLayout;
    @AutoGenerated
    private ComboBox select;
    
    
    
    // {section fields}
    // ****************
    
    private static org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(Quickselect.class);
    
    private Window win;
    // {end fields}

    // {section constructors}
    // **********************
    public Quickselect() {
        
        setCompositionRoot(buildMainLayout());
        
        configureComponents();
        
    }
    // {end constructors}

    // {section gettersandsetters}
    // ***************************
    // {end gettersandsetters}

    // {section publicmethods}
    // ***********************
    public static void show() {
        
        if(UI.getCurrent().getWindows().size() > 0) {
            return;
        }
        
        Quickselect qs = new Quickselect();
        Window temp = new Window("Quickselect");
        temp.setContent(qs);
        temp.setModal(true);
        temp.center();
        temp.setWidth("300px");
        temp.setHeight("80px");
        temp.setDraggable(false);
        temp.setResizable(false);
        UI.getCurrent().getUI().addWindow(temp);
        qs.setWindow(temp);
    }
    
    public void setWindow(Window win) {
        this.win = win;
    }
    // {end publicmethods}

    // {section privatemethods}
    // ************************
    private void configureComponents() {
        
        MenuItem root = (MenuItem) UI.getCurrent().getSession().getSession().getAttribute("menue_item");
        generateMenuItemList(root);
        
        select.setNullSelectionAllowed(false);
        select.setFilteringMode(FilteringMode.CONTAINS);
        select.setImmediate(true);
        select.focus();
        select.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                MenuItem item = (MenuItem) event.getProperty().getValue();
                if(item != null) {
                    item.getCommand().menuSelected(item);
                }
                if(win != null) {
                    win.close();
                }
                
            }
        });
    }
    
    private void generateMenuItemList(MenuItem menu) {
        
        if(menu.getCommand() != null) {
            select.addItem(menu);
            select.setItemCaption(menu, menu.getText());
        }
        
        if(menu.getChildren() == null) {
            return;
        }
        
        for (MenuItem sub : menu.getChildren()) {
            generateMenuItemList(sub);
        }
        
    }
    
    // {end privatemethods}

    // {section database}
    // ******************
    // {end database}

    // {section layout}
    // ****************
    
    @AutoGenerated
    private VerticalLayout buildMainLayout() {
        // common part: create layout
        mainLayout = new VerticalLayout();
        mainLayout.setImmediate(false);
        mainLayout.setWidth("100%");
        mainLayout.setHeight("100%");
        mainLayout.setMargin(false);
        
        // top-level component properties
        setWidth("100.0%");
        setHeight("100.0%");
        
        // select
        select = new ComboBox();
        select.setImmediate(false);
        select.setWidth("280px");
        select.setHeight("-1px");
        mainLayout.addComponent(select);
        mainLayout.setComponentAlignment(select, new Alignment(48));
        
        return mainLayout;
    }
    
    // {end layout}
}
