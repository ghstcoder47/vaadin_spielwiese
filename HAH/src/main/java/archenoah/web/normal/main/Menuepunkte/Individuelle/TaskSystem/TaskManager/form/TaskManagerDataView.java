package archenoah.web.normal.main.Menuepunkte.Individuelle.TaskSystem.TaskManager.form;

import java.text.DateFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Map.Entry;

import org.joda.time.LocalDate;
import org.tepi.filtertable.FilterTable;

import archenoah.config.CMS_Config_Std;
import archenoah.lib.custom.ComponentIterator;
import archenoah.lib.custom.MyUtils;
import archenoah.lib.custom.PauseablePollListener;
import archenoah.lib.tool.comunication.dbclass.DBClass;
import archenoah.lib.vaadin.Components.ClickMenuBar.ClickCommand;
import archenoah.lib.vaadin.Components.Steppers.IntStepper;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Tab_Menue_Item;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Window_Button;
import archenoah.lib.vaadin.Components.table.DataviewGenerator;
import archenoah.lib.vaadin.Components.table.FilteringTableUpdater;
import archenoah.lib.vaadin.CustomConverterFactorys.StringSqlTimestampConverter;
import archenoah.lib.vaadin.Language.i18n.I18nCB;
import archenoah.lib.vaadin.Language.i18n.I18nConverter;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalMessages;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalNotifiers;
import archenoah.lib.vaadin.Language.i18n.I18nManager;
import archenoah.lib.vaadin.MenuBerechtigung.Rechteholen;
import archenoah.lib.vaadin.resources.Icons;
import archenoah.web.normal.UserInfo.UserData;
import archenoah.web.normal.main.Menuepunkte.Individuelle.AuditManager.AuditLogging.classes.AuditTaskInfo;
import archenoah.web.normal.main.Menuepunkte.Individuelle.TaskSystem.TaskManager.classes.TTYPE;
import archenoah.web.normal.main.Menuepunkte.Individuelle.TaskSystem.TaskManager.filter.TaskManagerDecorator;

import com.google.common.base.Joiner;
import com.google.gwt.thirdparty.guava.common.base.Strings;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.event.UIEvents.PollEvent;
import com.vaadin.event.UIEvents.PollListener;
import com.vaadin.server.ThemeResource;
import com.vaadin.shared.ui.combobox.FilteringMode;
import com.vaadin.shared.ui.datefield.Resolution;
import com.vaadin.ui.AbstractComponent;
import com.vaadin.ui.AbstractField;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.CheckBox;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Layout;
import com.vaadin.ui.MenuBar;
import com.vaadin.ui.MenuBar.Command;
import com.vaadin.ui.MenuBar.MenuItem;
import com.vaadin.ui.PopupDateField;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TwinColSelect;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;
import com.vaadin.ui.Window.CloseEvent;
import com.vaadin.ui.Window.CloseListener;

import de.steinwedel.messagebox.ButtonId;
import de.steinwedel.messagebox.MessageBoxListener;


@SuppressWarnings({"serial", "rawtypes", "unchecked"})
public class TaskManagerDataView extends CustomComponent {

    /*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

    @AutoGenerated
    private HorizontalLayout mainLayout;

    @AutoGenerated
    private VerticalLayout mainContainer;

    @AutoGenerated
    private FilterTable tbl_data;

    @AutoGenerated
    private HorizontalLayout globalFilterContainer;

    @AutoGenerated
    private HorizontalLayout layoutFilterStatus;

    @AutoGenerated
    private TwinColSelect filterStatus;

    @AutoGenerated
    private CheckBox filterStatusEnabled;

    @AutoGenerated
    private HorizontalLayout filterTypeLayout;

    @AutoGenerated
    private ComboBox filterType;

    @AutoGenerated
    private CheckBox filterTypeEnabled;

    @AutoGenerated
    private HorizontalLayout layoutFilterMonth;

    @AutoGenerated
    private PopupDateField filterMonth;

    @AutoGenerated
    private CheckBox filterMonthEnabled;

    @AutoGenerated
    private CheckBox filterShowAll;

    @AutoGenerated
    private VerticalLayout menuSpacer;

    @AutoGenerated
    private MenuBar men_frm;

    

    

    

	

	

	

	

	

	

    /**
     * The constructor should first build the main layout, set the composition
     * root and then do any custom initialization.
     * 
     * The constructor will not be automatically regenerated by the visual
     * editor.
     */

    /**************** --> Allgemein <--- ********************/

    // Datenbank
    private Map<Object, String> componentMap;
    private FilteringTableUpdater tableUpdater = null;

    // Berrechtigung
    private int ACC_ID;

    private int permRead;
    private int permCreate;
    private int permUpdate;
    private int permDelete;

    private MenuItem tmpMenu = null;

    private Button tmpButton = null;
    /******************************************************/
    /**************** --> Tabsheetvars <--- *****************/
    private TabSheet tab = null;

    /******************************************************/
    /**************** --> Windowvars <--- *******************/
    private Window win = null;
    /******************************************************/
    
    private Layout embed = null;

    /******************* -> Menüpunkte <- ********************/
    private MenuBar.MenuItem btn_create;
    private MenuBar.MenuItem btn_update;
    private MenuBar.MenuItem btn_read;
    private MenuBar.MenuItem btn_delete;
    private MenuBar.MenuItem btn_filter;

    
    /*******************************************************/
    /******************* --> Custom <--- ********************/
    /******************************************************/

    private Boolean firstFilter = true;
    private PauseablePollListener pollListener = null;
    private boolean deferTableUpdates = true;
    
    enum Status {}
    
    enum TMD_NAME {};
    enum TMG_NAME {};
    enum TMMST_TOKEN {};
    enum TMMT_TOKEN {};
    enum TMMP_TOKEN {};
    enum TMMSV_TOKEN {};
    
    private HashMap<String, I18nConverter> converterMap;
    private Integer tableLastSize = 0;
    
    private IntStepper topicFilterIdField = new IntStepper();
    

    private TTYPE type = TTYPE.TASK;
    private AuditTaskInfo tinfo;
    private String presetTitle = null;
    
    /************ ----->Einstellungen<-- ********************/
//    private final String formIdLng = "301";
    private final String formIdPerm = "301";
    private final String winHeight = "600px";
    private final String winWidth = "900px";


    /******************************************************/

    private final String tableIdCol = "TMT_ID";
    
    //TASK cols
    private final Object[] tableColsAll = new Object[] { "TMT_ID", "TMT_CREATED", "TMT_ID_USER_CREATOR", "TMT_ID_USER_CONCERNS", "TMT_ID_USER_RESPONSIBLE", "TMT_DUE", 
    		"TMT_ID_USER_ASSIGNEE", "TMT_ID_TOPIC", "TMT_ID_DEPARTMENT", "TMT_ID_GROUP", "TMT_ID_STATUS", "TMT_ID_TYPE", "TMT_ID_PRIORITY", "TMT_TITLE", 
    		"TMT_DESCRIPTION", "TMT_SOLUTION", "TMT_EXTERNAL_CONTACT", "TMT_COMMENT",
    		"TMT_CAPA_RATING", "TMT_REMINDER_DATE",
    		"TMG_NAME",
    		"TMMST_TOKEN", "TMMT_TOKEN", "TMMTO_TOPIC", "TMMP_TOKEN",
    		"AMR_TOKEN", 
    		"creator", "responsible", "assigned"};
    //use custom Cols when needed
    private Object[] tableColsDefault = new Object[] { "TMT_ID", "TMT_TITLE", "TMT_CREATED", "creator", "responsible", "assigned", "TMT_DUE",
    		 "TMG_NAME", "TMMT_TOKEN", "AMR_TOKEN", "TMMP_TOKEN", "TMMST_TOKEN"};
    // embedded mode cols
    private Object[] tableColsEmbedded = new Object[] { "TMT_ID", "TMT_TITLE", "responsible", "assigned", "TMMST_TOKEN"};
    private Object[] tableColsCapa = new Object[] { "TMT_ID", "TMT_TITLE", "TMMT_TOKEN", "TMT_DUE", "TMMST_TOKEN"};
    //use custom Cols when needed
    private final Object[] tableColsFilter = tableColsDefault;
    private Object[] tableColsActive = tableColsDefault;

    private I18nManager i18n;
    
    public final static class caption extends I18nCB {
        static final I18nCB field_empty = set();
        static final I18nCB token_before = set();
        
        static final I18nCB date_minute = set();
        static final I18nCB date_minute_mult = set();
        static final I18nCB date_hour = set();
        static final I18nCB date_hour_mult = set();
        static final I18nCB date_day = set();
        static final I18nCB date_day_mult = set();
        
        static final I18nCB TASK = set();
        static final I18nCB CAPA = set();
    }
    /******************************************************/

    public TaskManagerDataView(MenuItem Arg_Menü) {
        tmpMenu = Arg_Menü;
    }

    public TaskManagerDataView(Button Arg_btn) {
        tmpButton = Arg_btn;
    }
    
    public TaskManagerDataView(){
        
    }
    
    /***************************** ---> Feste Funtionen<--- **************************************/

    /********* INIT-Window ************/
    public void init() {

        Standard_Init();

        if (tmpMenu != null) {
            String Recourcename = tmpMenu.getIcon().toString();
            Recourcename = Recourcename.substring(0, Recourcename.length() - 12) + "white-16.png";

            Build_Window_Button bwb = new Build_Window_Button(tmpMenu.getText(), mainLayout, winHeight, winWidth,
                    new ThemeResource(Recourcename));
            win = bwb.ReturnWindow();
        }
        if (tmpButton != null) {
            Build_Window_Button bwb = new Build_Window_Button(tmpButton.getCaption(), mainLayout, winHeight, winWidth,
                    tmpButton.getIcon());
            win = bwb.ReturnWindow();
        }

    }
    
    public Window getWindow(){
    	return win;
    }
    
    public TabSheet getTabSheet(){
    	return tab;
    }
    
    public void init(TabSheet Arg_tab) {

        Standard_Init();
        tab = Arg_tab;
        if (tmpMenu != null) {
            new Build_Tab_Menue_Item(Arg_tab, tmpMenu.getText(), mainLayout, tmpMenu.getIcon());
        }
        if (tmpButton != null) {
            new Build_Tab_Menue_Item(Arg_tab, tmpButton.getCaption(), mainLayout, tmpButton.getIcon());
        }

        setupListenersAndDetachEvent();
    }
    
    public void initIntegratedMode(){
        buildMainLayout();
        i18n = new I18nManager(this);
        
        registerComponents();
        generateMenu();

        setMenuPermissions();
        configureTable();
        configureComponents();
        
        configureIntegratedMode();
        
//        mainLayout.addDetachListener(onDetach);
        
        setCompositionRoot(mainLayout);
        
        pollListener = new PauseablePollListener() {};
        i18n.refresh();
    }
    
    public void setType(TTYPE type) {
        this.type = type;
    }
    
    public void setAuditTaskInfo(AuditTaskInfo tinfo) {
        this.tinfo = tinfo;
    }
    
    public void setTopicId(Integer tid){
        topicFilterIdField.setValue(tid);
        configureIntegratedMode();
        updateTable(true);
    }
    
    public void setTitle(String title) {
        this.presetTitle = title;
    }
    
    /********* Init-Standard ************/
    private void Standard_Init() {
        buildMainLayout();
        i18n = new I18nManager(this);
        
        registerComponents();
        
        generateMenu();
        
        setMenuPermissions();

        updateTable();
        tbl_data.setSortContainerPropertyId(tableIdCol);
        tbl_data.setSortAscending(true);
        tbl_data.sort();
        configureTable();
        configureComponents();
        
        updateTable();
        
//        checkShowAll();
        i18n.refresh();
        
    }
    
    // register components for lng and validation tools
    private void registerComponents(){
    	componentMap = new HashMap<Object, String>();
    	new ComponentIterator(mainContainer).createMap(componentMap);
    }
    
    private void setupListenersAndDetachEvent() {
        
        pollListener = PauseablePollListener.getListener(tab, mainLayout, new PollListener() {
            @Override
            public void poll(PollEvent event) {
                updateTable();
            }
        });
        
    }
    
    @SuppressWarnings("unused")
    public void setPermissionsFromDatabase() {
        if (formIdPerm == "") {
            System.out.println("Form Einstellung Fehlt: Berechtigung");
            return;
        }

        ACC_ID = (int) UI.getCurrent().getSession().getSession().getAttribute("Userid");
        Rechteholen r = new Rechteholen(ACC_ID + "");
        String[][] perms = r.Datenholen();

        for (int i = 0; i < perms.length; i++) {
            if (perms[i][0].equals(formIdPerm) == true) {

                permRead = Integer.valueOf(perms[i][3]);
                permUpdate = Integer.valueOf(perms[i][4]);
                permCreate = Integer.valueOf(perms[i][6]);
                permDelete = Integer.valueOf(perms[i][5]);
                
            }
        }
    }

    public void setPermissions(int create, int read, int update, int delete) {

        permCreate = create;
        permRead = read;
        permUpdate = update;
        permDelete = delete;

    }

    private void setMenuPermissions() {
        Boolean c = (permCreate == 1);
        Boolean r = (permRead == 1);
        Boolean u = (permUpdate == 1);
        Boolean d = (permDelete == 1);

        btn_create.setEnabled(c);
        btn_create.setVisible(c);

        btn_read.setEnabled(r);
        btn_read.setVisible(r);

        btn_update.setEnabled(u);
        btn_update.setVisible(u);

        btn_delete.setEnabled(d);
        btn_delete.setVisible(d);
    }

    /************ -><- ******************/

    /***************** Comands *********************/
    
    CloseListener closeListener = new CloseListener() {
		
		@Override
		public void windowClose(CloseEvent e) {
		    pollListener.resume();
			updateTable(true);
		}
	};
    
	private String getSelectedValue(){
		return Integer.toString((Integer) tbl_data.getContainerProperty(tbl_data.getValue(), tableIdCol).getValue());
	}
	
    //TASK Commands are here
    public ClickCommand cmd_btn_add = new ClickCommand() {
        @Override
        public void menuClicked(MenuItem selectedItem) {
        
        	TaskManagerInsertEdit pie = new TaskManagerInsertEdit(selectedItem, "");
        	pie.setPermissions(permCreate, permRead, permUpdate, permDelete);
        	pie.setType(type);
        	
        	if(topicFilterIdField.getValue() != 0){
        	    pie.setTopicId(topicFilterIdField.getValue());
        	}
        	
        	pie.init(i18n);
        	
           if(presetTitle != null) {
                pie.setTitle(presetTitle);
            }
        	
            if(tinfo != null) {
                pie.setInfo(tinfo.getTitle(),
                    tinfo.getInfo(),
                    tinfo.getHelp());
            }
           
            pie.getWindow().addCloseListener(closeListener);
        	this.setParent(men_frm);
        	this.setWindow(pie.getWindow());
        	
        	pollListener.pause();
        }
    };
    
    public ClickCommand cmd_btn_read = new ClickCommand() {
        @Override
        public void menuClicked(MenuItem selectedItem) {

            if(tbl_data.getValue() == null){
                I18nManager.global(I18nGlobalNotifiers.no_entry_selected);
                return;
            }
            
            TaskManagerInsertEdit pie = new TaskManagerInsertEdit(selectedItem, getSelectedValue());
        	pie.setPermissions(0, permRead, 0, 0);
        	pie.setType(getSelectedType());
        	pie.init(i18n);

        	this.setParent(men_frm);
        	this.setWindow(pie.getWindow());
        	
        	pollListener.pause();
        }
    };
    
    public ClickCommand cmd_btn_edit = new ClickCommand() {
        @Override
        public void menuClicked(MenuItem selectedItem) {
            
            if(tbl_data.getValue() == null){
                I18nManager.global(I18nGlobalNotifiers.no_entry_selected);
                return;
            }
            
            TaskManagerInsertEdit pie = new TaskManagerInsertEdit(selectedItem, getSelectedValue());
        	pie.setPermissions(permCreate, permRead, permUpdate, permDelete);
        	pie.setType(getSelectedType());
        	pie.init(i18n);
        	pie.getWindow().addCloseListener(closeListener);
        	this.setParent(men_frm);
        	this.setWindow(pie.getWindow());
        	
        	pollListener.pause();
            
        }
    };

    public Command cmd_btn_del = new Command() {
        @Override
        public void menuSelected(MenuItem selectedItem) {
            
            if(tbl_data.getValue() == null){
                I18nManager.global(I18nGlobalNotifiers.no_entry_selected);
                return;
            }
            
            deleteData(getSelectedValue());

        }
    };

    public Command cmd_btn_filter = new Command() {
        @Override
        public void menuSelected(MenuItem selectedItem) {

            if (firstFilter) {
                tbl_data.setFilterBarVisible(true);
                tbl_data.setFilterBarVisible(false);
                firstFilter = false;
            }
            tbl_data.setFilterBarVisible(!tbl_data.isFilterBarVisible());
            
            if(!tbl_data.isFilterBarVisible()){
                tbl_data.clearFilters();
            }
            
            tableColsActive = tbl_data.isFilterBarVisible() ? tableColsFilter : tableColsDefault;
            if(tableColsActive.length > 0 && tbl_data.size() > 0){
            	tbl_data.setVisibleColumns(tableColsActive);
            }

        }
    };

    
    /******************************************/

    private TTYPE getSelectedType() {
        String sysType = MyUtils.getValueFromItem(tbl_data.getContainerDataSource().getItem(tbl_data.getValue()), "TMT_SYSTEM_TYPE", String.class);
        
        return TTYPE.getTType(sysType);
        
    }
    
    private void deferTableUpdates(boolean defer) {
        this.deferTableUpdates = defer;
    }

    /*********** Gen Menüs *************/
    private void generateMenu() {

        btn_create = men_frm.addItem("FRM_ADD", Icons.White.add_16, cmd_btn_add);
        btn_update = men_frm.addItem("FRM_EDIT", Icons.White.edit_16, cmd_btn_edit);
        btn_read = men_frm.addItem("FRM_READ", Icons.White.perm_lesen_16, cmd_btn_read);
        btn_delete = men_frm.addItem("FRM_DEL", Icons.White.delete_16, cmd_btn_del);
        
        btn_filter = men_frm.addItem("FRM_FILTER", Icons.White.filter_16, cmd_btn_filter);

    }
    
    private void configureComponents(){
       
    	for (Entry<Object, String> entry : componentMap.entrySet()) {
    		AbstractComponent field = (AbstractComponent) entry.getKey();
    		
			field.setImmediate(true);
			
			
			if(field instanceof ComboBox){
				((ComboBox)field).setFilteringMode(FilteringMode.CONTAINS);
			}
			
		}
    	
    	deferTableUpdates(true);
    	
    	// SHOW ALL
    	filterShowAll.setImmediate(true);
    	filterShowAll.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                updateTable(true);
                
            }
        });
    	filterShowAll.setVisible(UserData.get().getQM().isQM());
    	
    	// MONTHPICKER
    	filterMonthEnabled.setValue(false);
    	filterMonthEnabled.setImmediate(true);
        filterMonth.setResolution(Resolution.MONTH);
        filterMonth.setDateFormat("MMM yyyy");
        filterMonth.setEnabled(true);
//        setGlobalFilterMonth(); // default unfiltered, should not show a lot since closed are excluded
        
        filterMonthEnabled.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                Boolean enabled = (Boolean)event.getProperty().getValue();
                filterMonth.setEnabled(enabled);
                if(enabled && filterMonth.getValue() == null){
                    setGlobalFilterMonth();
                }else if(!enabled){
                    filterMonth.setValue(null);
                }
                
            }
        });
        
        filterMonth.setImmediate(true);
        filterMonth.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                updateTable(true);
                
            }
        });
        
        // TYPE
        filterTypeEnabled.setValue(false);
        filterTypeEnabled.setImmediate(true);
        filterTypeEnabled.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                Boolean enabled = (Boolean)event.getProperty().getValue();
                filterType.setEnabled(enabled);
                if(!enabled){
                    filterType.setValue(null);
                }
                
            }
        });
        
        filterType.setEnabled(false);
        filterType.setImmediate(true);
        filterType.setWidth("90px");
        filterType.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                updateTable(true);
                
            }
        });
        fillTypeFilter();
        
        // STATUSPICKER
        filterStatusEnabled.setValue(true);
        filterStatusEnabled.setImmediate(true);
        converterMap.get("TMMST_TOKEN").attachDatasource(filterStatus);
        preselectStatusFilter();
        
        filterStatusEnabled.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                Boolean enabled = (Boolean)event.getProperty().getValue();
                filterStatus.setEnabled(enabled);
                updateTable(true);
                
            }
        });
        
        filterStatus.setImmediate(true);
        filterStatus.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                               
                updateTable(true);
                
            }
        });
    	
        deferTableUpdates(false);
    	
    }
    
    private void configureIntegratedMode(){
        
        filterMonthEnabled.setValue(false);
        filterShowAll.setValue(true);
        filterStatusEnabled.setValue(false);
        
        globalFilterContainer.setVisible(false);
        filterMonthEnabled.setEnabled(false);
        filterShowAll.setEnabled(true);
        filterStatusEnabled.setEnabled(false);
        mainContainer.setMargin(false);
        
        
        
        for (int i = 0; i < tbl_data.getVisibleColumns().length; i++) {
            Object col = tbl_data.getVisibleColumns()[i];
            tbl_data.setColumnCollapsed(col, true);
        }
        
        Object[] integratedColumns = null;
        
        switch (type) {
        case TASK:
            integratedColumns = tableColsEmbedded;
            break;
        case CAPA:
            integratedColumns = tableColsCapa;
            break;
        default:
            integratedColumns = tableColsEmbedded;
            break;
        }
        
        for (int i = 0; i < integratedColumns.length; i++) {
            Object col = integratedColumns[i];
            tbl_data.setColumnCollapsed(col, false);
        }
        
        tbl_data.setColumnExpandRatio("TMT_TITLE", 10);
        
    }
    
    private void checkShowAll(){
        if(tbl_data.size() == 0){
            filterShowAll.setValue(true);
            updateTable(true);
//            configureTable();
//            setTableHeaders();
        }
    }
    
    private void fillTypeFilter() {
        
        
        for (TTYPE type : TTYPE.values()) {
            filterType.addItem(type);
            filterType.setItemCaption(type, i18n.get(type.name()));
        }
    }
    
    private void preselectStatusFilter(){
        HashSet<Integer> preselected = new HashSet<Integer>();
        Collections.addAll(preselected, filterStatus.getContainerDataSource().getItemIds().toArray(new Integer[0]));
        preselected.remove(0);
        filterStatus.setValue(preselected);
    }
    
    public void setGlobalFilterMonth(Date date){
        LocalDate ld = new LocalDate(date);
        filterMonthEnabled.setValue(true);
        filterMonth.setValue(new LocalDate(ld.getYear(), ld.getMonthOfYear(), 1).toDate());
    }
    
    public void setGlobalFilterMonth(){
        setGlobalFilterMonth(new Date());
    }
    
    private ArrayList<AbstractField> getActiveGlobalFilters(){
        ArrayList<AbstractField> al = new ArrayList<AbstractField>();
        
        if(!filterShowAll.getValue()){
            al.add(filterShowAll);
        }
        
        if(filterMonthEnabled.getValue() &&  filterMonth.getValue() != null){
            al.add(filterMonth);
        }
        
        if(filterTypeEnabled.getValue() && filterType.getValue() != null){
            al.add(filterType);
        }
        
        if(filterStatusEnabled.getValue() && ((Collection) filterStatus.getValue()).size() > 0){
            al.add(filterStatus);
        }
        
        if(topicFilterIdField.getValue() != 0){
            al.add(topicFilterIdField);
        }
        
        return al;
    }
    
    private Boolean hasGlobalFilters(ArrayList a){
        
        return (a.size() > 0);
        
    }
    
    private Boolean hasGlobalFilters(){
        
        return hasGlobalFilters(getActiveGlobalFilters());
        
    }
    
    /*************************** Config TBL ********************/

    private void configureTable() {
        tbl_data.setSelectable(true);
        tbl_data.setFilterOnDemand(false);
        tbl_data.setImmediate(true);
        tbl_data.setColumnCollapsingAllowed(true);
        tbl_data.setFooterVisible(true);
        tbl_data.setPageLength(1);
        try {
        	if(tableColsActive.length > 0){
        		tbl_data.setVisibleColumns(tableColsActive);
        	}
		} catch (Exception e) {
//		    System.out.println("error setting columns ");
		}
        
        if(tbl_data.size() > 0){
            
            StringSqlTimestampConverter date = new StringSqlTimestampConverter();
            date.setDateFormat(DateFormat.SHORT);
            
            StringSqlTimestampConverter time = new StringSqlTimestampConverter();
            time.setDateFormat(DateFormat.SHORT);
            time.setTimeFormat(DateFormat.SHORT);
            
            tbl_data.setConverter("TMT_CREATED", time);
            tbl_data.setConverter("TMT_DUE", date);
        
            
        }
        
        tableUpdater = new FilteringTableUpdater(tbl_data);
        tableUpdater.showSum("TMMST_TOKEN");
        

        for (Object col : tableColsAll) {
        	
        	try {
        		tbl_data.setColumnExpandRatio(col, 1);
			} catch (Exception e) {
				
			}
        		
		}
        
        tbl_data.setColumnExpandRatio("TMT_ID", 0);
        tbl_data.setColumnExpandRatio("TMT_TITLE", 4);
        
        tbl_data.setColumnExpandRatio("creator", 2);
        tbl_data.setColumnExpandRatio("responsible", 2);
        tbl_data.setColumnExpandRatio("assigned", 2);
        
        tbl_data.setColumnExpandRatio("TMMST_TOKEN", 1.2f);
        
       
        
        converterMap = new HashMap<String, I18nConverter>();
        
    	generateConverter(converterMap, "cust_taskmanager_master_types", "TMMT_TOKEN", "TMMT_ID");
    	generateConverter(converterMap, "cust_taskmanager_master_status", "TMMST_TOKEN","TMMST_ID");
//    	generateConverter(converterMap, "cust_taskmanager_master_severities", "TMMSV_TOKEN","TMMSV_ID");
    	generateConverter(converterMap, "cust_taskmanager_master_priorities", "TMMP_TOKEN", "TMMP_ID");
    	
    	TaskManagerDecorator decorator = new TaskManagerDecorator(converterMap);
    	tbl_data.setFilterDecorator(decorator);
    	tbl_data.setFilterOnDemand(false);
    	
//    	setConverter(converterMap, "TMMT_TOKEN");
//    	setConverter(converterMap, "TMMST_TOKEN");
////    	setConverter(converterMap, "TMMSV_TOKEN");
//    	setConverter(converterMap, "TMMP_TOKEN");
    	
        DataviewGenerator gen = new DataviewGenerator();
        gen.addConverter("TMMT_TOKEN", new I18nConverter("cust_taskmanager_master_types", "TMMT_TOKEN"));
        gen.addConverter("TMMST_TOKEN", new I18nConverter("cust_taskmanager_master_status", "TMMST_TOKEN"));
        gen.addConverter("TMMP_TOKEN", new I18nConverter("cust_taskmanager_master_priorities", "TMMP_TOKEN"));
        gen.addConverter("AMR_TOKEN", new I18nConverter("cust_audit_master_rating", "AMR_TOKEN"));
        
        gen.attach(tbl_data);
    	
    	
    }
    
    private void generateConverter(HashMap<String, I18nConverter> converterMap, String table, String name, String id){
    	converterMap.put(name, new I18nConverter(table, id, name));
    }
    
    private void setConverter(HashMap<String, I18nConverter> converterMap, String name){
    	try {
    		tbl_data.setConverter(name, converterMap.get(name));
		} catch (Exception e) {
//		    System.out.println("error setting converter " + name);
		}
    	
    }


    /*************************** Database ********************/
    
    /********************************/
    
    
    private void updateTable(){
        updateTable(false);
    }
    
    private void updateTable(Boolean ignoreFilter) {
        
        if(deferTableUpdates) {
            return;
        }
        
        if (ignoreFilter || !tbl_data.isFilterBarVisible()) {
            dbGetContainer();
            try{
            	if(tableColsDefault.length > 0){
            		tbl_data.setVisibleColumns(tableColsActive);
            	}
            }catch(Exception e){
//                e.printStackTrace();
            }
        }
        
        if(tableLastSize == 0){
            configureTable();
            if(topicFilterIdField.getValue() != 0){
                configureIntegratedMode();
            }
            
        }
        
        tableLastSize = tbl_data.size();
        
        
    }
    
    private void deleteData(final String id){
        
        I18nManager.global(I18nGlobalMessages.confirm_delete, new MessageBoxListener() {
            
            @Override
            public void buttonClicked(ButtonId arg0) {
                if(ButtonId.YES == arg0) {
                    dbDeleteData(id);
                }
            }
        });
    }
    
    
    //TASK dbget
	private void dbGetContainer() {
        CMS_Config_Std std = CMS_Config_Std.getInstance();

        DBClass db = new DBClass();

        /************ Set Spalten *************/
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("*");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(cms_auth_stammdaten_user.AUL_VORNAME, ', ', cms_auth_stammdaten_user.AUL_NAME)", "creator");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(responsible.AUL_VORNAME, ', ', responsible.AUL_NAME)", "responsible");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(assigned.AUL_VORNAME, ', ', assigned.AUL_NAME)", "assigned");
//        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(concerns.AUL_VORNAME, ', ', concerns.AUL_NAME)", "concerns");
        
        /**************************************/
        /************ Set Tabelle *************/
//        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_taskmanager_tasks");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "INNER JOIN", "cms_auth_stammdaten_user", "TMT_ID_USER_CREATOR", "AUL_ID");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung_Graph("LEFT JOIN", "cms_auth_stammdaten_user as responsible", "responsible", "cust_taskmanager_tasks", "AUL_ID", "TMT_ID_USER_RESPONSIBLE");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung_Graph("LEFT JOIN", "cms_auth_stammdaten_user as assigned", "assigned", "cust_taskmanager_tasks", "AUL_ID", "TMT_ID_USER_ASSIGNEE");
//        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung_Graph("LEFT JOIN", "cms_auth_stammdaten_user as concerns", "concerns", "cust_taskmanager_tasks", "AUL_ID", "TMT_ID_USER_CONCERNS");
        
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_groups", "TMT_ID_DEPARTMENT", "TMG_ID");
        
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_master_status", "TMT_ID_STATUS", "TMMST_ID");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_master_types", "TMT_ID_TYPE", "TMMT_ID");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_master_priorities", "TMT_ID_PRIORITY", "TMMP_ID");
//        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_master_severities", "TMT_ID_SEVERITY", "TMMSV_ID");
       if(!filterShowAll.getValue()){
            db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_group_members", "TMT_ID_DEPARTMENT", "TMGM_ID_GROUP");
            db.DB_Data_Get.DB_Gruppieren.DB_Gruppieren("TMT_ID");
        }
        
        /**************************************/
        /************ Set Filter *************/
        String glue = "";
        
        ArrayList<AbstractField> filterList = getActiveGlobalFilters(); 
        
        if(filterList.contains(filterShowAll)){
            
            filterList.remove(filterShowAll);
            glue = hasGlobalFilters(filterList) ? "AND" : "";
            
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("( cust_taskmanager_tasks", "TMT_ID_USER_CREATOR", "=", Integer.toString(ACC_ID), "OR");
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_tasks", "TMT_ID_USER_RESPONSIBLE", "=", Integer.toString(ACC_ID), "OR");
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_group_members", "TMGM_ID_USER", "=", Integer.toString(ACC_ID), "OR");
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_tasks", "TMT_ID_USER_ASSIGNEE", "=", Integer.toString(ACC_ID), ") " + glue);

        }
        
        if(filterList.contains(filterMonth)){
            
            java.sql.Timestamp sqlDateFrom = new java.sql.Timestamp(filterMonth.getValue().getTime());
            java.sql.Timestamp sqlDateUntil = new java.sql.Timestamp(new LocalDate(filterMonth.getValue()).plusMonths(1).toDate().getTime());
            
            filterList.remove(filterMonth);
            glue = hasGlobalFilters(filterList) ? "AND" : "";

            
            db.DB_Data_Get.DB_Filter.DB_WHERE_BETWEEN("(cust_taskmanager_tasks", "TMT_DUE", "'" + sqlDateFrom.toString() + "'",  "'" + sqlDateUntil.toString() + "'", "OR");
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("(cust_taskmanager_tasks", "TMT_DUE", "IS", "NULL", "AND");
            db.DB_Data_Get.DB_Filter.DB_WHERE_BETWEEN("cust_taskmanager_tasks", "TMT_CREATED", "'" + sqlDateFrom.toString() + "'",  "'" + sqlDateUntil.toString() + "'", ")) " + glue);
        }
        
        if(filterList.contains(filterType)){
            
            filterList.remove(filterType);
            glue = hasGlobalFilters(filterList) ? "AND" : "";
            
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_tasks", "TMT_SYSTEM_TYPE", "=", "'" + filterType.getValue() + "'", glue);
            
        }
        
        if(filterList.contains(filterStatus)){
            
            filterList.remove(filterStatus);
            glue = hasGlobalFilters(filterList) ? "AND" : "";
            
            String ids = Joiner.on(",").join((Collection<Integer>)filterStatus.getValue()).toString();
            
            db.DB_Data_Get.DB_Filter.DB_WHERE_In("cust_taskmanager_tasks", "TMT_ID_STATUS", ids, glue);
        }
        
        /**************************************/
        
        if(filterList.contains(topicFilterIdField) && type != null){
            
            db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_meeting_topic_tasks", "TMT_ID", "TMETT_ID_TASK AND TMETT_TYPE = " + type.toSqlString());
            
            filterList.remove(topicFilterIdField);
            glue = hasGlobalFilters(filterList) ? "AND" : "";
            
            String taskId = topicFilterIdField.getValue().toString();
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_meeting_topic_tasks", "TMETT_ID_TOPIC", "=", taskId, glue);
            
            db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("NULL as AMR_TOKEN"); // hack to deal with column collapsing in integrated views
            
        }else {
            db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_tasks", "RIGHT JOIN", "cust_taskmanager_meeting_topic_tasks", "TMT_SYSTEM_TYPE", "TMETT_TYPE and TMT_ID = TMETT_ID_TASK");
            db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_taskmanager_meeting_topic_tasks", "RIGHT JOIN", "cust_audit_logging_findings", "TMETT_ID_TOPIC", "ALF_ID");
            db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_audit_logging_findings", "RIGHT JOIN", "cust_audit_master_rating", "ALF_RATING", "AMR_ID");
        }
        
        /**************************************/
        /************ Set Custom *************/
        /**************************************/

//        "TMD_NAME", "TMG_NAME",
//		"TMMST_TOKEN", "TMMT_TOKEN", "TMMP_TOKEN", "TMMSV_TOKEN",

       
//        db.DB_Data_Get.Set_Type("TMD_NAME", TMD_NAME.class);
        db.DB_Data_Get.Set_Type("TMG_NAME", TMG_NAME.class);
//        
//        db.DB_Data_Get.Set_Type("TMMST_TOKEN", TMMST_TOKEN.class);
//        db.DB_Data_Get.Set_Type("TMMT_TOKEN", TMMT_TOKEN.class);
//        db.DB_Data_Get.Set_Type("TMMP_TOKEN", TMMP_TOKEN.class);
//        db.DB_Data_Get.Set_Type("TMMSV_TOKEN", TMMSV_TOKEN.class);
        
        /* **************************/
        
//        db.debugNextQuery(true);
        
        try {
        	Container container = db.DB_Data_Get.DB_SEND_AND_GET_Container();
            
        	if (tableUpdater != null) {
                tableUpdater.updateTable(container);
            } else {
                tbl_data.setContainerDataSource(container);
            }
        	
		} catch (Exception e) {
			// TASK: handle exception
			System.out.println("exception!");
			UI.getCurrent().getUI().removePollListener(pollListener);
		}
        
    }
    
    private String generateCollectionString(Collection<Integer> ids){
        String in = "";
        String comma = "";
        
        for (Integer integer : ids) {
            in += comma + integer;
            if(Strings.isNullOrEmpty(comma)){
                comma = ", ";
            }
        }
        
        return in;
    }
    
    private void dbDeleteData(String id){
    
        CMS_Config_Std std = CMS_Config_Std.getInstance();
    
        DBClass db = new DBClass();
        db.DB_Data_Delete.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_taskmanager_tasks");
        db.DB_Data_Delete.DB_Filter.DB_WHERE_Allgemein("cust_taskmanager_tasks", tableIdCol, "=", id, "");
        db.DB_Data_Delete.DB_Delete();
    
        I18nManager.global(I18nGlobalNotifiers.entry_deleted);
        
        updateTable(true);

        
    }
    
    @AutoGenerated
    private HorizontalLayout buildMainLayout() {
        // common part: create layout
        mainLayout = new HorizontalLayout();
        mainLayout.setImmediate(false);
        mainLayout.setWidth("100%");
        mainLayout.setHeight("100%");
        mainLayout.setMargin(false);
        
        // top-level component properties
        setWidth("100.0%");
        setHeight("100.0%");
        
        // mainContainer
        mainContainer = buildMainContainer();
        mainLayout.addComponent(mainContainer);
        mainLayout.setExpandRatio(mainContainer, 1.0f);
        mainLayout.setComponentAlignment(mainContainer, new Alignment(20));
        
        return mainLayout;
    }

    @AutoGenerated
    private VerticalLayout buildMainContainer() {
        // common part: create layout
        mainContainer = new VerticalLayout();
        mainContainer.setImmediate(false);
        mainContainer.setWidth("100.0%");
        mainContainer.setHeight("100.0%");
        mainContainer.setMargin(true);
        
        // menuSpacer
        menuSpacer = buildMenuSpacer();
        mainContainer.addComponent(menuSpacer);
        
        // globalFilterContainer
        globalFilterContainer = buildGlobalFilterContainer();
        mainContainer.addComponent(globalFilterContainer);
        mainContainer.setComponentAlignment(globalFilterContainer, new Alignment(48));
        
        // tbl_data
        tbl_data = new FilterTable();
        tbl_data.setImmediate(true);
        tbl_data.setWidth("100.0%");
        tbl_data.setHeight("100.0%");
        mainContainer.addComponent(tbl_data);
        mainContainer.setExpandRatio(tbl_data, 1.0f);
        mainContainer.setComponentAlignment(tbl_data, new Alignment(20));
        
        return mainContainer;
    }

    @AutoGenerated
    private VerticalLayout buildMenuSpacer() {
        // common part: create layout
        menuSpacer = new VerticalLayout();
        menuSpacer.setImmediate(false);
        menuSpacer.setWidth("100.0%");
        menuSpacer.setHeight("40px");
        menuSpacer.setMargin(false);
        
        // men_frm
        men_frm = new MenuBar();
        men_frm.setImmediate(false);
        men_frm.setWidth("100.0%");
        men_frm.setHeight("-1px");
        menuSpacer.addComponent(men_frm);
        menuSpacer.setComponentAlignment(men_frm, new Alignment(20));
        
        return menuSpacer;
    }

    @AutoGenerated
    private HorizontalLayout buildGlobalFilterContainer() {
        // common part: create layout
        globalFilterContainer = new HorizontalLayout();
        globalFilterContainer.setImmediate(false);
        globalFilterContainer.setWidth("100.0%");
        globalFilterContainer.setHeight("80px");
        globalFilterContainer.setMargin(false);
        
        // filterShowAll
        filterShowAll = new CheckBox();
        filterShowAll.setCaption("Alle Tasks anzeigen");
        filterShowAll.setImmediate(false);
        filterShowAll.setWidth("-1px");
        filterShowAll.setHeight("-1px");
        globalFilterContainer.addComponent(filterShowAll);
        globalFilterContainer.setExpandRatio(filterShowAll, 2.0f);
        globalFilterContainer.setComponentAlignment(filterShowAll, new Alignment(48));
        
        // layoutFilterMonth
        layoutFilterMonth = buildLayoutFilterMonth();
        globalFilterContainer.addComponent(layoutFilterMonth);
        globalFilterContainer.setExpandRatio(layoutFilterMonth, 1.0f);
        globalFilterContainer.setComponentAlignment(layoutFilterMonth, new Alignment(48));
        
        // filterTypeLayout
        filterTypeLayout = buildFilterTypeLayout();
        globalFilterContainer.addComponent(filterTypeLayout);
        globalFilterContainer.setExpandRatio(filterTypeLayout, 1.0f);
        globalFilterContainer.setComponentAlignment(filterTypeLayout, new Alignment(48));
        
        // layoutFilterStatus
        layoutFilterStatus = buildLayoutFilterStatus();
        globalFilterContainer.addComponent(layoutFilterStatus);
        globalFilterContainer.setExpandRatio(layoutFilterStatus, 2.0f);
        globalFilterContainer.setComponentAlignment(layoutFilterStatus, new Alignment(6));
        
        return globalFilterContainer;
    }

    @AutoGenerated
    private HorizontalLayout buildLayoutFilterMonth() {
        // common part: create layout
        layoutFilterMonth = new HorizontalLayout();
        layoutFilterMonth.setImmediate(false);
        layoutFilterMonth.setWidth("-1px");
        layoutFilterMonth.setHeight("-1px");
        layoutFilterMonth.setMargin(false);
        layoutFilterMonth.setSpacing(true);
        
        // filterMonthEnabled
        filterMonthEnabled = new CheckBox();
        filterMonthEnabled.setCaption("Monatsfilter");
        filterMonthEnabled.setImmediate(false);
        filterMonthEnabled.setWidth("-1px");
        filterMonthEnabled.setHeight("-1px");
        layoutFilterMonth.addComponent(filterMonthEnabled);
        layoutFilterMonth.setComponentAlignment(filterMonthEnabled, new Alignment(48));
        
        // filterMonth
        filterMonth = new PopupDateField();
        filterMonth.setImmediate(false);
        filterMonth.setWidth("-1px");
        filterMonth.setHeight("-1px");
        layoutFilterMonth.addComponent(filterMonth);
        layoutFilterMonth.setComponentAlignment(filterMonth, new Alignment(48));
        
        return layoutFilterMonth;
    }

    @AutoGenerated
    private HorizontalLayout buildFilterTypeLayout() {
        // common part: create layout
        filterTypeLayout = new HorizontalLayout();
        filterTypeLayout.setImmediate(false);
        filterTypeLayout.setWidth("-1px");
        filterTypeLayout.setHeight("-1px");
        filterTypeLayout.setMargin(false);
        filterTypeLayout.setSpacing(true);
        
        // filterTypeEnabled
        filterTypeEnabled = new CheckBox();
        filterTypeEnabled.setCaption("Quelle");
        filterTypeEnabled.setImmediate(false);
        filterTypeEnabled.setWidth("-1px");
        filterTypeEnabled.setHeight("-1px");
        filterTypeLayout.addComponent(filterTypeEnabled);
        filterTypeLayout.setComponentAlignment(filterTypeEnabled, new Alignment(48));
        
        // filterType
        filterType = new ComboBox();
        filterType.setImmediate(false);
        filterType.setWidth("-1px");
        filterType.setHeight("-1px");
        filterTypeLayout.addComponent(filterType);
        filterTypeLayout.setComponentAlignment(filterType, new Alignment(48));
        
        return filterTypeLayout;
    }

    @AutoGenerated
    private HorizontalLayout buildLayoutFilterStatus() {
        // common part: create layout
        layoutFilterStatus = new HorizontalLayout();
        layoutFilterStatus.setImmediate(false);
        layoutFilterStatus.setWidth("-1px");
        layoutFilterStatus.setHeight("-1px");
        layoutFilterStatus.setMargin(false);
        layoutFilterStatus.setSpacing(true);
        
        // filterStatusEnabled
        filterStatusEnabled = new CheckBox();
        filterStatusEnabled.setCaption("Statusfilter");
        filterStatusEnabled.setImmediate(false);
        filterStatusEnabled.setWidth("-1px");
        filterStatusEnabled.setHeight("-1px");
        layoutFilterStatus.addComponent(filterStatusEnabled);
        layoutFilterStatus.setComponentAlignment(filterStatusEnabled, new Alignment(48));
        
        // filterStatus
        filterStatus = new TwinColSelect();
        filterStatus.setImmediate(false);
        filterStatus.setWidth("-1px");
        filterStatus.setHeight("68px");
        layoutFilterStatus.addComponent(filterStatus);
        layoutFilterStatus.setComponentAlignment(filterStatus, new Alignment(48));
        
        return layoutFilterStatus;
    }
}
