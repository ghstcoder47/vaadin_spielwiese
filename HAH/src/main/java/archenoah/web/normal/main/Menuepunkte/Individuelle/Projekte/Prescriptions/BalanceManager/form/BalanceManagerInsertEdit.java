package archenoah.web.normal.main.Menuepunkte.Individuelle.Projekte.Prescriptions.BalanceManager.form;

import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Objects;

import archenoah.lib.custom.ComponentIterator;
import archenoah.lib.custom.MyUtils;
import archenoah.lib.tool.comunication.dbclass.DBClass;
import archenoah.lib.vaadin.Components.Combo.combo;
import archenoah.lib.vaadin.Components.Steppers.IntStepper;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Tab_Menue_Item;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Window_Button;
import archenoah.lib.vaadin.Forms_Builder.Form_Bind;
import archenoah.lib.vaadin.Language.i18n.I18nConverter;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalNotifiers;
import archenoah.lib.vaadin.Language.i18n.I18nManager;
import archenoah.lib.vaadin.MenuBerechtigung.Rechteholen;
import archenoah.lib.vaadin.valchecker.val_checker4;
import archenoah.web.normal.UserInfo.Country;
import archenoah.web.normal.UserInfo.UserData;
import archenoah.web.normal.main.Menuepunkte.Individuelle.Projekte.Prescriptions.PrescriptionManager.classes.PrescriptionBalance;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container.Filter;
import com.vaadin.data.Item;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.data.util.IndexedContainer;
import com.vaadin.server.ThemeResource;
import com.vaadin.shared.ui.combobox.FilteringMode;
import com.vaadin.ui.AbstractField;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.MenuBar.MenuItem;
import com.vaadin.ui.Panel;
import com.vaadin.ui.TabSheet;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

@SuppressWarnings({"serial", "rawtypes", "unchecked"})
public class BalanceManagerInsertEdit extends CustomComponent {

    /*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

    @AutoGenerated
    private VerticalLayout mainLayout;

    @AutoGenerated
    private HorizontalLayout buttons;

    @AutoGenerated
    private Button btn_save;

    @AutoGenerated
    private VerticalLayout main;

    @AutoGenerated
    private Panel panelData;

    @AutoGenerated
    private VerticalLayout verticalLayout_2;

    @AutoGenerated
    private TextField fieldComment;

    @AutoGenerated
    private ComboBox fieldAction;

    @AutoGenerated
    private IntStepper fieldDelta;

    @AutoGenerated
    private ComboBox fieldProduct;

    @AutoGenerated
    private ComboBox fieldPatient;

    @AutoGenerated
    private Panel panelManagement;

    @AutoGenerated
    private VerticalLayout verticalLayout_4;

    @AutoGenerated
    private ComboBox fieldUser;

    @AutoGenerated
    private ComboBox fieldProject;

    

    

    

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

    /**
     * The constructor should first build the main layout, set the composition
     * root and then do any custom initialization.
     * 
     * The constructor will not be automatically regenerated by the visual
     * editor.
     */

    /**************** --> Allgemein <--- ********************/
    // Allgemein
    private org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(this.getClass());
    private String exportCaption;
    
    // Datenbank
    private Map<Object, String> componentMap;
    private Map<Object, String> dbMap;
    private Map<Object, String> validateMap;
    private Form_Bind fb;
    private String dataSetId = "";

    
    // Berrechtigung
    private int ACC_ID;
	private Integer permRead;
	private Integer permUpdate;
	private Integer permCreate;
	private Integer permDelete;

    private MenuItem tmpMenu = null;
    private Button tmpButton = null;
    /******************************************************/
    /**************** --> Tabsheetvars <--- *****************/
    private TabSheet tab = null;
    /******************************************************/
    /**************** --> Windowvars <--- *******************/
    private Window win = null;
    /******************************************************/
    /******************* --> Custom <--- ********************/
    /******************************************************/
    
    private Map<Object, String> disabledMap;
    
    /************ ----->Einstellungen<-- ********************/
//    private final String formIdLng = "202";
    private final String formIdPerm = "202";
    private final String Windows_Height = "500px";
    private final String Windows_Width = "300px";

    private I18nManager i18n;
    
//    private final String dataIdCol = "XX_ID";
//    private final String dataTableName = "cust_XX";
    
    /******************************************************/

    public BalanceManagerInsertEdit(MenuItem Arg_Menü, String Arg_Form_ID) {
        tmpMenu = Arg_Menü;
        dataSetId = Arg_Form_ID;
    }

    public BalanceManagerInsertEdit(Button Arg_btn, String Arg_Form_ID) {
        tmpButton = Arg_btn;
        dataSetId = Arg_Form_ID;
    }

    /********* INIT-Window ************/
    public void init() {
        if (Windows_Height.equals("") == true || Windows_Width.equals("") == true) {
            System.out.println("Form Einstellung Fehlt: !!!");
            return;
        }

        Standard_Init();

        String fid = dataSetId;
        if (fid != "") {
            fid = " - #" + fid;
        }

        if (tmpMenu != null) {
        	
            String Recourcename = null;
            ThemeResource resource = null;
            if(tmpMenu.getIcon() != null){
            	Recourcename = tmpMenu.getIcon().toString();
            	Recourcename = Recourcename.substring(0, Recourcename.length() - 12) + "white-16.png";
            	resource = new ThemeResource(Recourcename);
            }

            exportCaption = tmpMenu.getText();
            Build_Window_Button bwb = new Build_Window_Button(tmpMenu.getText() + fid, mainLayout, Windows_Height, Windows_Width, resource);
            win = bwb.ReturnWindow();
        }
        if (tmpButton != null) {
            exportCaption = tmpButton.getCaption();
            Build_Window_Button bwb = new Build_Window_Button(tmpButton.getCaption() + fid, mainLayout, Windows_Height, Windows_Width, tmpButton.getIcon());
            win = bwb.ReturnWindow();
        }

    }

    /********* INIT-Tray ************/
    public void init(TabSheet Arg_tab) {

        Standard_Init();
        tab = Arg_tab;
        if (tmpMenu != null) {
            exportCaption = tmpMenu.getText();
            new Build_Tab_Menue_Item(Arg_tab, tmpMenu.getText(), mainLayout, tmpMenu.getIcon());
        }
        if (tmpButton != null) {
            exportCaption = tmpButton.getCaption();
            new Build_Tab_Menue_Item(Arg_tab, tmpButton.getCaption(), mainLayout, tmpButton.getIcon());
        }

    }
    
    public Window getWindow(){
    	return win;
    }
    
    public TabSheet getTabSheet(){
    	return tab;
    }
    
    public void fillFromItem(Item item) {
        fillForm(item);
    }
    
    /********* Init-Standard ************/
    private void Standard_Init() {
        buildMainLayout();
        i18n = new I18nManager(this);
        
        fb = new Form_Bind();
        ACC_ID = (int) UI.getCurrent().getSession().getSession().getAttribute("Userid");
        
        registerComponents();
        
        fillFields();
        fillDbMap();

        setCustomValidators();
        fillValidateMap();

        /***************/

//        if (dataSetId != "") {
//        	
////            dbFillForm();
//            
//        } else {
//            
//        	//TASK "create init"
//        	
//        }
        
        fieldUser.setValue(ACC_ID);
        
        setMenuPermissions();
        configureComponents();
        
        setEventListeners();
        
    }
    
 // register components for lng and validation tools
    private void registerComponents(){
    	componentMap = new HashMap<Object, String>();
    	new ComponentIterator(main).createMap(componentMap);
    }
    
    
    private void configureComponents(){
    	
    	for (Entry<Object, String> entry : componentMap.entrySet()) {
    		AbstractField field = (AbstractField) entry.getKey();
    		
			field.setImmediate(true);
			field.setWidth("200px");
			
			if(field instanceof ComboBox){
				((ComboBox)field).setFilteringMode(FilteringMode.CONTAINS);
			}
			
		}
    	
    	fieldProject.setRequired(true);
    	fieldProduct.setRequired(true);
    	fieldPatient.setRequired(true);
    	
    	
    	fieldProject.setItemCaptionPropertyId("PSLV_NAME");
        fieldProduct.setItemCaptionPropertyId("PP_PRODUCT");
    	
    	fieldUser.setEnabled(false);
    	fieldUser.setStyleName("nogrey");
    	
    	fieldComment.setStyleName("cust_textarea_no_margin");
    	fieldComment.setRequired(true);
    	
        disabledMap = new HashMap<Object, String>();
        disabledMap.putAll(componentMap);
        disabledMap.remove(fieldUser);
        disabledMap.remove(fieldProject);
    	
        for (Entry<Object, String> entry : disabledMap.entrySet()) {
            AbstractField field = (AbstractField) entry.getKey();
            field.setEnabled(false);
        }
        
        btn_save.setEnabled(false);
        
    	componentListeners();
    	
    }
    
    private void componentListeners(){

       fieldProject.addValueChangeListener(new ValueChangeListener() {
            
            @Override
            public void valueChange(ValueChangeEvent event) {
                
                Boolean selected = (event.getProperty().getValue() != null);
                
                fillFields(true);
                
                for (Entry<Object, String> entry : disabledMap.entrySet()) {
                    AbstractField field = (AbstractField) entry.getKey();
                    field.setEnabled(selected);
                }
                btn_save.setEnabled(selected);
            }
        });
        
    }
    
    /*************************** Events *******************************/

    private void setEventListeners() {

        btn_save.addClickListener(new ClickListener() {

            @Override
            public void buttonClick(ClickEvent event) {

                if (validate() == false) {
                    I18nManager.global(I18nGlobalNotifiers.fields_empty);
                    return;
                }
                
//                if (dataSetId.equals("") == true) {
//                	
////                    dataSetId = Integer.toString(dbInsert());
//                    
//                } else {
//                	
////                    dbUpdate();
//                    
//
//                }

                updateBalance();

                //TASK check if save successful
                UI.getCurrent().getUI().removeWindow(win);
            }

        });

       
    }

    /******************************************************************/
    
    /************************ --> Berrechtigung <-- **************************/

    @SuppressWarnings("unused")
    public void setPermissionsFromDatabase() {
        if (formIdPerm == "") {
            System.out.println("Form Einstellung Fehlt: Berechtigung");
            return;
        }

        
        Rechteholen r = new Rechteholen(ACC_ID + "");
        String[][] perms = r.Datenholen();

        for (int i = 0; i < perms.length; i++) {
            if (perms[i][0].equals(formIdPerm) == true) {

                permRead = Integer.valueOf(perms[i][3]);
                permUpdate = Integer.valueOf(perms[i][4]);
                permCreate = Integer.valueOf(perms[i][6]);
                permDelete = Integer.valueOf(perms[i][5]);
                
            }
        }
    }

    public void setPermissions(int create, int read, int update, int delete) {

        permCreate = create;
        permRead = read;
        permUpdate = update;
        permDelete = delete;

    }

    private void setMenuPermissions() {
        Boolean c = (permCreate == 1);
        Boolean r = (permRead == 1);
        Boolean u = (permUpdate == 1);
        Boolean d = (permDelete == 1);

        btn_save.setEnabled((c||u));

    }
    
    /***********************************************/
    
    private void fillFields(){
        fillFields(false);
    }
    
    private void fillFields(Boolean keepProject){
        
        if(!keepProject){
            fillProjects();
            fillUser();
        }else {
            
        
        
        fillProducts();
        fillPatient();
        fillAction();
        
        }

    }
    
    private void fillForm(Item item) {
        
        try {
            fieldProject.setValue(item.getItemProperty("PP_ID_PROJECT").getValue());
            fieldPatient.setValue(item.getItemProperty("PSL_ID").getValue());
            fieldProduct.setValue(item.getItemProperty("PP_ID").getValue());
        } catch (Exception e) {
            System.out.println("error preselecting fields");
        }
        
        
    }
    
    private void updateBalance(){ //TASK add field for dataId option?
        PrescriptionBalance balance = new PrescriptionBalance();
        balance.setPatientId((Integer) fieldPatient.getValue());
        
        String action = PrescriptionBalance.MANUAL;
        
        if(fieldAction.getValue() != null) {
            action = fieldAction.getValue().toString();
        }
        
        balance.editBalance((Integer) fieldProduct.getValue(), fieldDelta.getValue(), action, fieldComment.getValue(),
            Objects.toString(UserData.get().getUserId()));
    }
    
    
    
    private void fillProjects(){
        
        DBClass db = new DBClass();
        
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_projekte_stammdaten_liste", "INNER JOIN ", "cust_prescriptions_products", "PSLV_ID", "PP_ID_PROJECT");
        db.DB_Data_Get.DB_Gruppieren.DB_Gruppieren("PSLV_ID");
        
        fieldProject.setContainerDataSource(MyUtils.convertIndex(db.DB_Data_Get.DB_SEND_AND_GET_Container(), "PSLV_ID"));
    }
    
    private String getSelectedProjectId(){
        String value = "";
        
        if(fieldProject.getValue() != null) {
            value = fieldProject.getValue().toString();
        }
        
        return value; 
    }
    
    private void fillProducts(){

        DBClass db = new DBClass();
        
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cust_prescriptions_products");
        
        if(fieldProject.getValue() != null){
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_prescriptions_products", "PP_ID_PROJECT", "=", getSelectedProjectId(), "");
        }
        
        fieldProduct.setContainerDataSource(MyUtils.convertIndex(db.DB_Data_Get.DB_SEND_AND_GET_Container(), "PP_ID"));
        
    }
    
    private void fillPatient() {

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("PSL_ID");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(PSL_TITEL,' ',PSA_NAME,' ',PSL_NAME,' ',PSL_VORNAME)", "Patientenname");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_patient_stammdaten_liste", "INNER JOIN", "cust_patient_stammdaten_anrede", "PSL_ANREDE", "PSA_ID");
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cust_patient_stammdaten_liste", "RIGHT JOIN", "cust_verk_haupt", "PSL_ID", "VH_PATIENT_ID");
        
        Country uc = MyUtils.getUserData().getCountry();
        if(uc.hasPermissions()) {
            db.DB_Data_Get.DB_Filter.DB_WHERE_In("cust_patient_stammdaten_liste", "PSL_COUNTYCODE", uc.getFilterString(), fieldProject.getValue() != null ? "AND" : "");
        }
        
        if(fieldProject.getValue() != null && (Integer) fieldProject.getValue() != 1000){
            db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cust_verk_haupt", "VH_PROJEKT_ID", "=", getSelectedProjectId(), "");
        }
        db.DB_Data_Get.DB_Ordnen.DB_Ordnen("PSL_NAME", "ASC");
        db.DB_Data_Get.DB_Gruppieren.DB_Gruppieren("PSL_ID");
        
//        db.debugNextQuery(true);
        
        try {
            fieldPatient.removeAllItems();
            combo nc = new combo(db.DB_Data_Get.DB_SEND_AND_GET(), fieldPatient, "PSL_ID", "Patientenname");
        } catch (Exception e) {
            fieldPatient.removeAllItems();
        }

        db.DB_Data_Get.connclose();

        fieldPatient.setFilteringMode(FilteringMode.CONTAINS);
    }
    
    private void fillUser() {

        DBClass db = new DBClass();
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("AUL_ID");
        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_Einzeln("CONCAT(AUL_NAME, ', ', AUL_VORNAME)", "user");
        
        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Verknüpfung("cms_auth_stammdaten_user", "INNER JOIN", "cms_auth_stammdaten_anrede", "AUL_ANREDE_ID", "ASA_ID");
        
        db.DB_Data_Get.DB_Gruppieren.DB_Gruppieren("AUL_ID");
        
        
        db.debugNextQuery(false);
        
        try {
            fieldUser.removeAllItems();
            combo nc = new combo(db.DB_Data_Get.DB_SEND_AND_GET(), fieldUser, "AUL_ID", "user");
        } catch (Exception e) {
            fieldUser.removeAllItems();
        }

        db.DB_Data_Get.connclose();

        fieldUser.setFilteringMode(FilteringMode.CONTAINS);
    }
    
    private void fillAction() {
        
        I18nConverter lng = new I18nConverter("cust_prescription_balance_actions", "PBA_ID", "PBA_ACTION");
        IndexedContainer source = lng.getLocalizedContainer();
        source.addContainerFilter(new Filter() {
            
            @Override
            public boolean passesFilter(Object itemId, Item item) throws UnsupportedOperationException {
                return (Integer) itemId > 100;
            }
            
            @Override
            public boolean appliesToProperty(Object propertyId) {
                return false;
            }
        });
        fieldAction.setContainerDataSource(source);
        fieldAction.setItemCaptionPropertyId(I18nConverter.CAPTION_PROPERTY);
    }
    
    
    /******************** Database *****************/
    private void fillDbMap() {
        dbMap = new HashMap<>();
//        dbMap.put(component, "table:COLUMN");

    }

//    private void dbFillForm() {
//        DBClass db = new DBClass(std.Standard_Server_URL, std.Standard_Server_Username, std.Standard_Server_Passwort, std.Standard_Server_Database,
//                std.Standard_Server_Port);
//        db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
//
//        /******************************** Table ****************************************/
//        db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln(dataTableName);
//        /******************************************************************************/
//        /******************************** Filter ****************************************/
//        db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein(dataTableName, dataIdCol, "=", dataSetId, "");
//        /******************************************************************************/
//
//        // db.DB_Data_Get.Set_Type("SLF_VON_UHRZEIT", Date.class);
//        // db.DB_Data_Get.Set_Type("SLF_BIS_UHRZEIT", Date.class);
//
//        Container con = db.DB_Data_Get.DB_SEND_AND_GET_Container();
//        fb = new Form_Bind();
//        
//        if(con.size() > 0){
//        	fb.Get_and_Fill(con, dbMap);
//        }
//        
//    }

//    private int dbInsert() {
//        DBClass db = new DBClass(std.Standard_Server_URL, std.Standard_Server_Username, std.Standard_Server_Passwort, std.Standard_Server_Database,
//                std.Standard_Server_Port);
//        fb = new Form_Bind();
//        fb.Insert(db, dbMap);
//        /******************************** Table ****************************************/
//        db.DB_Data_Insert.DB_Tabellen.DB_set_Tabelle_Einzeln(dataTableName);
//        /******************************************************************************/
//        // dba.DB_Data_Insert.DB_DEBUG_SQL_STRING();
//        return db.DB_Data_Insert.DB_Insert();
//    }
//
//    private void dbUpdate() {
//        DBClass db = new DBClass(std.Standard_Server_URL, std.Standard_Server_Username, std.Standard_Server_Passwort, std.Standard_Server_Database,
//                std.Standard_Server_Port);
//        fb = new Form_Bind();
//        fb.Update(db, dbMap);
//
//        /******************************** Table ****************************************/
//        db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln(dataTableName);
//        /******************************************************************************/
//        /******************************** Filter ****************************************/
//        db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein(dataTableName, dataIdCol, "=", dataSetId, "");
//        /******************************************************************************/
//        db.DB_Data_Update.DB_Update();
//
//    }

    /*********************** -->Validierung<-- ********************/
    private void fillValidateMap() {
        validateMap = new HashMap<>();
        validateMap.putAll(componentMap);
        
//        ValidateMap.put(component, "component"); // should not be needed

    }

    private void setCustomValidators() {

        // psw_pass_1.addValidator(new Custom_Benutzerform_psw_ändern(psw_pass_1, psw_pass_2));

        /******* manual actions *******/

    }

    private boolean validate() {
        val_checker4 val = new val_checker4(validateMap);
        if (val.Is_Valid() == false) {
            return false;
        } else {
            return true;
        }

    }

    @AutoGenerated
    private VerticalLayout buildMainLayout() {
        // common part: create layout
        mainLayout = new VerticalLayout();
        mainLayout.setStyleName("cust_margin_half_full_none_full");
        mainLayout.setImmediate(false);
        mainLayout.setWidth("100%");
        mainLayout.setHeight("100%");
        mainLayout.setMargin(true);
        
        // top-level component properties
        setWidth("100.0%");
        setHeight("100.0%");
        
        // main
        main = buildMain();
        mainLayout.addComponent(main);
        mainLayout.setExpandRatio(main, 9.0f);
        mainLayout.setComponentAlignment(main, new Alignment(48));
        
        // buttons
        buttons = buildButtons();
        mainLayout.addComponent(buttons);
        mainLayout.setExpandRatio(buttons, 1.0f);
        mainLayout.setComponentAlignment(buttons, new Alignment(48));
        
        return mainLayout;
    }

    @AutoGenerated
    private VerticalLayout buildMain() {
        // common part: create layout
        main = new VerticalLayout();
        main.setImmediate(false);
        main.setWidth("100.0%");
        main.setHeight("100.0%");
        main.setMargin(false);
        main.setSpacing(true);
        
        // panelManagement
        panelManagement = buildPanelManagement();
        main.addComponent(panelManagement);
        main.setExpandRatio(panelManagement, 2.0f);
        main.setComponentAlignment(panelManagement, new Alignment(48));
        
        // panelData
        panelData = buildPanelData();
        main.addComponent(panelData);
        main.setExpandRatio(panelData, 5.0f);
        
        return main;
    }

    @AutoGenerated
    private Panel buildPanelManagement() {
        // common part: create layout
        panelManagement = new Panel();
        panelManagement.setCaption("Verwaltungsdaten");
        panelManagement.setImmediate(false);
        panelManagement.setWidth("100.0%");
        panelManagement.setHeight("100.0%");
        
        // verticalLayout_4
        verticalLayout_4 = buildVerticalLayout_4();
        panelManagement.setContent(verticalLayout_4);
        
        return panelManagement;
    }

    @AutoGenerated
    private VerticalLayout buildVerticalLayout_4() {
        // common part: create layout
        verticalLayout_4 = new VerticalLayout();
        verticalLayout_4.setImmediate(false);
        verticalLayout_4.setWidth("100.0%");
        verticalLayout_4.setHeight("100.0%");
        verticalLayout_4.setMargin(false);
        
        // fieldProject
        fieldProject = new ComboBox();
        fieldProject.setCaption("Projekt");
        fieldProject.setImmediate(false);
        fieldProject.setWidth("-1px");
        fieldProject.setHeight("-1px");
        verticalLayout_4.addComponent(fieldProject);
        verticalLayout_4.setComponentAlignment(fieldProject, new Alignment(48));
        
        // fieldUser
        fieldUser = new ComboBox();
        fieldUser.setCaption("Bearbeiter");
        fieldUser.setImmediate(false);
        fieldUser.setWidth("-1px");
        fieldUser.setHeight("-1px");
        verticalLayout_4.addComponent(fieldUser);
        verticalLayout_4.setComponentAlignment(fieldUser, new Alignment(48));
        
        return verticalLayout_4;
    }

    @AutoGenerated
    private Panel buildPanelData() {
        // common part: create layout
        panelData = new Panel();
        panelData.setCaption("Änderungsdaten");
        panelData.setImmediate(false);
        panelData.setWidth("100.0%");
        panelData.setHeight("100.0%");
        
        // verticalLayout_2
        verticalLayout_2 = buildVerticalLayout_2();
        panelData.setContent(verticalLayout_2);
        
        return panelData;
    }

    @AutoGenerated
    private VerticalLayout buildVerticalLayout_2() {
        // common part: create layout
        verticalLayout_2 = new VerticalLayout();
        verticalLayout_2.setImmediate(false);
        verticalLayout_2.setWidth("100.0%");
        verticalLayout_2.setHeight("100.0%");
        verticalLayout_2.setMargin(false);
        
        // fieldPatient
        fieldPatient = new ComboBox();
        fieldPatient.setCaption("Patient");
        fieldPatient.setImmediate(false);
        fieldPatient.setWidth("-1px");
        fieldPatient.setHeight("-1px");
        verticalLayout_2.addComponent(fieldPatient);
        verticalLayout_2.setComponentAlignment(fieldPatient, new Alignment(48));
        
        // fieldProduct
        fieldProduct = new ComboBox();
        fieldProduct.setCaption("Medikament");
        fieldProduct.setImmediate(false);
        fieldProduct.setWidth("-1px");
        fieldProduct.setHeight("-1px");
        verticalLayout_2.addComponent(fieldProduct);
        verticalLayout_2.setComponentAlignment(fieldProduct, new Alignment(48));
        
        // fieldDelta
        fieldDelta = new IntStepper();
        fieldDelta.setCaption("Delta");
        fieldDelta.setImmediate(false);
        fieldDelta.setWidth("-1px");
        fieldDelta.setHeight("-1px");
        verticalLayout_2.addComponent(fieldDelta);
        verticalLayout_2.setComponentAlignment(fieldDelta, new Alignment(48));
        
        // fieldAction
        fieldAction = new ComboBox();
        fieldAction.setCaption("Vorgang");
        fieldAction.setImmediate(false);
        fieldAction.setWidth("-1px");
        fieldAction.setHeight("-1px");
        verticalLayout_2.addComponent(fieldAction);
        verticalLayout_2.setComponentAlignment(fieldAction, new Alignment(48));
        
        // fieldComment
        fieldComment = new TextField();
        fieldComment.setCaption("Kommentar");
        fieldComment.setImmediate(false);
        fieldComment.setWidth("-1px");
        fieldComment.setHeight("-1px");
        verticalLayout_2.addComponent(fieldComment);
        verticalLayout_2.setComponentAlignment(fieldComment, new Alignment(20));
        
        return verticalLayout_2;
    }

    @AutoGenerated
    private HorizontalLayout buildButtons() {
        // common part: create layout
        buttons = new HorizontalLayout();
        buttons.setImmediate(false);
        buttons.setWidth("100.0%");
        buttons.setHeight("100.0%");
        buttons.setMargin(false);
        
        // btn_save
        btn_save = new Button();
        btn_save.setCaption("Speichern");
        btn_save.setImmediate(true);
        btn_save.setWidth("-1px");
        btn_save.setHeight("-1px");
        buttons.addComponent(btn_save);
        buttons.setComponentAlignment(btn_save, new Alignment(48));
        
        return buttons;
    }

}
