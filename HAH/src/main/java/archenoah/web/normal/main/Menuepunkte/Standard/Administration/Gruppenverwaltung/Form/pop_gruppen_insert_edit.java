package archenoah.web.normal.main.Menuepunkte.Standard.Administration.Gruppenverwaltung.Form;

import java.util.HashMap;
import java.util.Map;

import archenoah.config.CMS_Config_Std;
import archenoah.lib.tool.comunication.dbclass.DBClass;
import archenoah.lib.vaadin.Components.Window_Tab_Generierer.Build_Window_Button;
import archenoah.lib.vaadin.Forms_Builder.Form_Bind;
import archenoah.lib.vaadin.Language.i18n.I18nGlobalNotifiers;
import archenoah.lib.vaadin.Language.i18n.I18nManager;
import archenoah.lib.vaadin.valchecker.val_checker4;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

public class pop_gruppen_insert_edit extends CustomComponent {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private Button btn_save;
	@AutoGenerated
	private TextField txt_grp;
	
	/**
	 * The constructor should first build the main layout, set the
	 * composition root and then do any custom initialization.
	 *
	 * The constructor will not be automatically regenerated by the
	 * visual editor.
	 */
	
	
	
	/********************** Standard Deklarationen**********************/
	private String Form_ID = "";
	private Map<Object, String> DBMap;
	private Map <Object, String> ValidateMap;
	private CMS_Config_Std std;
	private DBClass db;
	private Form_Bind fb;
	private Window win;
    private I18nManager i18n;


	
	/*******************************************************************/
	
	public pop_gruppen_insert_edit(Button btn,String Arg_Form_ID) {
		buildMainLayout();
		i18n = new I18nManager(this);
		std = CMS_Config_Std.getInstance();
		fb = new Form_Bind();
		Form_ID = Arg_Form_ID;
		
		Gen_Window(btn);
		Set_DB_Map();
	//	Validate_Test();
		
		if(Form_ID != "")
		{
			Forms_Fill();
		}
		event();

		// migrated from database
		txt_grp.setRequired(true);
		// migration end
		// TODO add user code here
	}
	
	private void event()
	{
		btn_save.addClickListener(new ClickListener() {
			
			@Override
			public void buttonClick(ClickEvent event) {
				// TODO Automatisch generierter Methodenstub
				
				if(Validate_Test() == false)
				{
				I18nManager.global(I18nGlobalNotifiers.fields_empty);
					return;
				}
				
				
				
				
				
				if(Form_ID.equals("")==true)
				{
					Forms_Insert();
				}else
				{
					Forms_Update();
				}
				
			
				UI.getCurrent().getUI().removeWindow(win);
				
				
			}
		});
		
	}

	public void Gen_Window(Button tab)
	{
		Build_Window_Button bwb = new Build_Window_Button(tab.getCaption(),mainLayout,"250px","250px",tab.getIcon());
		win = bwb.ReturnWindow();
	}
	
	private void Set_DB_Map()
	{
		DBMap = new HashMap<>();
		DBMap.put(txt_grp,"cms_auth_stammdaten_group:AGL_NAME");
	}

	private void Forms_Fill()
	{
		db = new DBClass();
		db.DB_Data_Get.DB_Spalten.Standard.DB_set_Spalten_All();
		DB_Table();
		DB_Filter();
		Container con = db.DB_Data_Get.DB_SEND_AND_GET_Container();
		fb = new Form_Bind();
			
				for (Object ItemIda : con.getItemIds()) {
		           fb.Get_and_Fill(con, DBMap);
				}
	}
	private void Forms_Insert()
	{
		db = new DBClass();	
		fb = new Form_Bind();
		fb.Insert(db, DBMap);
		db.DB_Data_Insert.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_group");
		//DB_Filter();
		db.DB_Data_Insert.DB_Insert();
	}
	private void Forms_Update()
	{
		db = new DBClass();	
		fb = new Form_Bind();
		fb.Update(db,DBMap);
		db.DB_Data_Update.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_group");
		db.DB_Data_Update.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_group", "AGL_ID", "=", Form_ID, "");
		db.DB_Data_Update.DB_Update();
	}
	
	
	private void DB_Table()
	{
		db.DB_Data_Get.DB_Tabellen.DB_set_Tabelle_Einzeln("cms_auth_stammdaten_group");
		
		
	}
	
	private void DB_Filter()
	{
		db.DB_Data_Get.DB_Filter.DB_WHERE_Allgemein("cms_auth_stammdaten_group", "AGL_ID", "=", Form_ID, "");
		
	}
	
	
	/********************** END  Datenbank Funktionen**********************/
	private boolean Validate_Test()
	{
		val_checker4 val = new val_checker4(DBMap);
		if(val.Is_Valid() == false)
		{
			return false;
		}else
		{
			return true;
		}
		
	}
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");
		mainLayout.setMargin(true);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");
		
		// txt_grp
		txt_grp = new TextField();
		txt_grp.setCaption("Gruppe");
		txt_grp.setImmediate(false);
		txt_grp.setWidth("-1px");
		txt_grp.setHeight("-1px");
		mainLayout.addComponent(txt_grp);
		mainLayout.setComponentAlignment(txt_grp, new Alignment(48));
		
		// btn_save
		btn_save = new Button();
		btn_save.setCaption("Speichern");
		btn_save.setImmediate(true);
		btn_save.setWidth("-1px");
		btn_save.setHeight("-1px");
		mainLayout.addComponent(btn_save);
		mainLayout.setComponentAlignment(btn_save, new Alignment(48));
		
		return mainLayout;
	}
	
}

